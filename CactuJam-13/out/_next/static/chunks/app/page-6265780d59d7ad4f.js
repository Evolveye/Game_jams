(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{361:(e,t,i)=>{Promise.resolve().then(i.bind(i,5327))},5327:(e,t,i)=>{"use strict";i.d(t,{default:()=>ex});var s=i(5155),a=i(5359),r=i(587),l=i(5465),o=i(2115),n=new WeakMap,h=new WeakMap,d=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap;class g{setUIUpdater(e){(0,l._)(this,u,e)}updateUi(e){(0,a._)(this,u)&&(0,a._)(this,u).call(this,structuredClone(e))}registerTimer(e,t,i){(0,a._)(this,c).add({type:e,id:"interval"===e?window.setInterval(i,t):window.setTimeout(i,t)})}registerEvent(e,t,i){(0,a._)(this,d).add({element:e,eventname:t,handler:i}),e.addEventListener(t,i)}registerCtx(e,t){let i="string"!=typeof t?t:this.rootElement.querySelector(t),s=null==i?void 0:i.getContext("2d");if("string"==typeof t&&!i)throw Error('Canvas "'.concat(e,'" not found with provided selector: "').concat(t,'"'));if(!s)throw Error('Cannot create 2D context for "'.concat(e,'" canvas'));let a=()=>{s.canvas.width=s.canvas.clientWidth*window.devicePixelRatio,s.canvas.height=s.canvas.clientHeight*window.devicePixelRatio,s.imageSmoothingEnabled=!1};return this.ctxs.set(e,s),this.registerEvent(window,"resize",a),a(),s}startLoop(e){this.pauseLoop(),(0,l._)(this,h,e),this.resumeLoop()}pauseLoop(){(0,a._)(this,n)&&window.cancelAnimationFrame((0,a._)(this,n)),(0,l._)(this,n,null)}resumeLoop(){let e=(0,a._)(this,h);if(!e||(0,a._)(this,n))return;let t=1e3/(0,a._)(this,p),i=performance.now(),s=a=>{let r=a-i,o=Math.round(1/r*1e3),h=r/t;i=a,(0,l._)(this,n,window.requestAnimationFrame(s)),h>0&&e(h,o)};s(performance.now())}dispose(){console.log("dispose"),this.pauseLoop(),(0,a._)(this,d).forEach(e=>{e.element.removeEventListener(e.eventname,e.handler)}),(0,a._)(this,c).forEach(e=>{"interval"===e.type?window.clearInterval(e.id):window.clearTimeout(e.id)})}constructor(e){(0,r._)(this,n,{writable:!0,value:void 0}),(0,r._)(this,h,{writable:!0,value:void 0}),(0,r._)(this,d,{writable:!0,value:void 0}),(0,r._)(this,c,{writable:!0,value:void 0}),(0,r._)(this,u,{writable:!0,value:void 0}),(0,r._)(this,p,{writable:!0,value:void 0}),(0,l._)(this,n,-1),(0,l._)(this,h,null),(0,l._)(this,d,new Set),(0,l._)(this,c,new Set),(0,l._)(this,u,null),(0,l._)(this,p,60),this.ctxs=new Map,this.rootElement=e}}function A(e){let t={};return e.forEach(e=>t[e]=e),t}var m=new WeakMap,f=new WeakMap;class w{setPressed(e){(0,a._)(this,m)!==e&&((0,l._)(this,f,!1),(0,l._)(this,m,e))}getPressed(){return(0,a._)(this,m)}getOnce(){return!(!(0,a._)(this,m)||(0,a._)(this,f))&&((0,l._)(this,f,!0),!0)}constructor(e,t=!1,i=!1){(0,r._)(this,m,{writable:!0,value:void 0}),(0,r._)(this,f,{writable:!0,value:void 0}),this.code=e,(0,l._)(this,m,t),(0,l._)(this,f,i)}}class y{static isPressed(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t){let t=y.keysMap.get(e.toLowerCase());if(null==t?void 0:t.getPressed())return!0}return!1}static isPressedOnce(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t){let t=y.keysMap.get(e.toLowerCase());if(null==t?void 0:t.getOnce())return!0}return!1}}y.keysMap=new Map,window.addEventListener("keydown",e=>{let{code:t}=e,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")?i=t.slice(5):t.startsWith("Digit")&&(i=t.slice(5)),i=i.toLowerCase();let s=y.keysMap.get(i);s?s.setPressed(!0):y.keysMap.set(i,new w(i,!0))}),window.addEventListener("keyup",e=>{let{code:t}=e,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")&&(i=t.slice(5)),i=i.toLowerCase();let s=y.keysMap.get(i);s?s.setPressed(!1):y.keysMap.set(i,new w(i,!1))});var v=i(949),x=new WeakMap,_=new WeakMap,b=new WeakMap,M=new WeakMap,j=new WeakMap,S=new WeakMap,C=new WeakMap;class P{onLoad(e){(0,a._)(this,M).addEventListener("load",()=>e(this),{once:!0})}constructor(e,t=1,i=1,s=t*i){(0,r._)(this,x,{writable:!0,value:void 0}),(0,r._)(this,_,{writable:!0,value:void 0}),(0,r._)(this,b,{writable:!0,value:void 0}),(0,r._)(this,M,{writable:!0,value:void 0}),(0,r._)(this,j,{writable:!0,value:void 0}),(0,r._)(this,S,{writable:!0,value:void 0}),(0,r._)(this,C,{writable:!0,value:void 0}),(0,l._)(this,j,0),(0,l._)(this,S,-1),(0,l._)(this,C,-1),this.getWidth=()=>(0,a._)(this,M).width/(0,a._)(this,_),this.getHeight=()=>(0,a._)(this,M).height/(0,a._)(this,b),this.nextFrame=()=>{(0,a._)(this,j)<(0,a._)(this,x)-1?(0,v._)(this,j).value++:(0,l._)(this,j,0)},this.draw=(e,t,i,s,r)=>{let l=(0,a._)(this,M),o=(0,a._)(this,S),n=(0,a._)(this,C),h=(0,a._)(this,j)%(0,a._)(this,_)*o,d=Math.floor((0,a._)(this,j)/(0,a._)(this,_))*n;s||(s=l.width),r||(r=l.height),e.drawImage(l,h,d,o,n,t,i,s,r)},(0,l._)(this,M,new Image),(0,a._)(this,M).src=e,(0,l._)(this,_,t),(0,l._)(this,b,i),(0,l._)(this,x,s),(0,a._)(this,M).addEventListener("load",()=>{(0,l._)(this,S,(0,a._)(this,M).width/(0,a._)(this,_)),(0,l._)(this,C,(0,a._)(this,M).height/(0,a._)(this,b)),(0,l._)(this,j,0)},{once:!0})}}class E{update(){this.updatesCount++}draw(e){var t,i;let{ctx:s,camera:a,inTranslationDrawer:r,drawCenter:l,scale:o={},translate:n={}}=e,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.x,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.y,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;null!=u||(u=(c?this.h*c/this.w:this.h)*this.sizeMultiplier),null!=c||(c=this.w*this.sizeMultiplier);let p=a.getLookingAtTranslate(this,s.canvas,h,d),g=c/2,A=u/2;s.save(),s.translate((null!==(i=n.x)&&void 0!==i?i:0)+p.x,p.y),s.rotate(-this.angle),(o.x||o.y)&&s.scale(o.x||1,o.y||1),this.boudingBoxColor&&(s.fillStyle=this.boudingBoxColor,s.fillRect(-g,-A,c,u)),null===(t=this.sprite)||void 0===t||t.draw(s,-g,-A,c,u),null==r||r(),l&&(s.beginPath(),s.fillStyle="white",s.arc(0,0,5,0,2*Math.PI),s.fill()),s.restore()}constructor(e,t,{defaultSprite:i,sprites:s={},labels:a=[],sizeMultiplier:r,height:l=0,width:o=0,framesPerRow:n,framesPerColumn:h,framesCount:d,boudingBoxColor:c}={}){var u,p=this;this.updatesCount=0,this.sizeMultiplier=E.sizeMultiplier,this.setAngle=e=>this.angle=Math.PI/180*e,this.setSize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;p.w=e,p.h=t},this.isKey=e=>y.isPressed(e),this.isKeyOnce=e=>y.isPressedOnce(e),this.nextFrame=()=>{var e;return null===(e=this.sprite)||void 0===e?void 0:e.nextFrame()},this.tick=()=>{this.nextFrame()},this.labels=a,this.moreSprites=Object.fromEntries(Object.entries(s).map(e=>{let[t,i]=e;return[t,new P(i.src,i.framesPerRow,i.framesPerColumn,i.framesCount)]})),this.sprite=i?this.moreSprites[i]:void 0,this.x=e,this.y=t,this.w=o,this.h=l,this.halfWidth=o*this.sizeMultiplier/2,this.halfHeight=l*this.sizeMultiplier/2,this.angle=0,r&&(this.sizeMultiplier=r),this.boudingBoxColor=c,null===(u=this.sprite)||void 0===u||u.onLoad(e=>{this.w||(this.w=e.getWidth()),this.h||(this.h=e.getHeight()),this.halfWidth=this.w*this.sizeMultiplier/2,this.halfHeight=this.h*this.sizeMultiplier/2})}}E.sizeMultiplier=1;class k extends E{processStopTop(e,t){let{entity:i}=e,{bottom:s}=t;s&&(this.y=i.y-i.halfHeight-this.halfHeight,this.velocity.y=0,this.groundedOn=i)}processStop(e,t){let{entity:i,velocity:s}=e,{left:a,right:r}=t;0!==this.velocity.x&&(a||r)&&(this.x=i.x-Math.sign(s.x)*(i.halfWidth+this.halfWidth),Math.abs(s.x)>10?(this.velocity.x*=-.75,this.velocity.y*=1.1):this.velocity.x=0)}update(e){let{surroundingSolids:t=[],reactions:i={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s,a=this;let r={};if(i["stop-top"]=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a.processStopTop(...t)},i.stop=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a.processStop(...t)},!this.groundedOn){let t=this.gravity*e;this.velocity.y>0?this.velocity.y+=2*t:this.velocity.y+=t}let l={x:this.x,y:this.y},o={x:this.velocity.x*e,y:this.velocity.y*e};for(let e of(this.x+=o.x,this.y+=o.y,t)){if(!this.velocity.x&&!this.velocity.y&&e instanceof k&&!e.velocity.x&&!e.velocity.y)continue;let t=l.x-this.halfWidth-(e.x+e.halfWidth),a=e.x-e.halfWidth-(l.x+this.halfWidth),n=l.y-this.halfHeight-(e.y+e.halfHeight),h=e.y-e.halfHeight-(l.y+this.halfHeight),d=t<0&&a>=0,c=t>=0&&a<0,u=n<0&&h>=0,p=n>=0&&h<0;if(this.groundedOn===e&&d!==c&&(this.groundedOn=!1),o.x<0&&d||o.x>0&&c||o.y<0&&u||o.y>0&&p)continue;let g=0===o.y&&e instanceof k?-e.velocity.y:o.y,A=!d&&!c&&0!==g&&(g<0?p&&n+g<=0:u&&h-g<=0),m=!u&&!p&&0!==o.x&&(o.x<0?c&&t+o.x<=0:d&&a-o.x<=0);if(A||m)for(let t of e.labels)r[t]=null===(s=i[t])||void 0===s?void 0:s.call(i,{entity:e,velocity:o},{left:m&&this.velocity.x>0,right:m&&this.velocity.x<0,top:A&&g<0,bottom:A&&g>0})}return super.update(e),r}constructor(...e){super(...e),this.groundedOn=!0,this.velocity={x:0,y:0},this.gravity=1.5}}let W={src:"/Game_jams/CactuJam-13/out/_next/static/media/platform.3d2e5b4d.png"},L={src:"/Game_jams/CactuJam-13/out/_next/static/media/platform-terminator.41faee50.png"};class z extends k{draw(e){let{ctx:t,...i}=e;super.draw({ctx:t,...i,inTranslationDrawer:()=>{t.fillStyle="brown",t.font="bold 32px consolas",t.fillText("".concat(this.floorIndex).padStart(4," "),-this.x-70,0)}})}constructor(e,t,i,s,a,r={}){super(e,t,{...r,width:i,height:s,labels:["stop-top","platform"],sprites:{platform:{src:W.src}},defaultSprite:"platform"}),this.floorIndex=a}}class H extends k{constructor(e,t,i,s,a={}){super(e,t,{...a,width:i,height:s,labels:["stop-top","terminator"],sprites:{terminator:{src:L.src}},defaultSprite:"terminator"})}}class O extends k{constructor(e,t,i,s,a={}){super(e,t,{...a,width:i,height:s,labels:["stop"]})}}let R={src:"/Game_jams/CactuJam-13/out/_next/static/media/player.4ed078fe.png"},N={src:"/Game_jams/CactuJam-13/out/_next/static/media/player-idle.e78d2a02.png"},G={src:"/Game_jams/CactuJam-13/out/_next/static/media/player-falling.d47805f1.png"},J={src:"/Game_jams/CactuJam-13/out/_next/static/media/powerup-doubleJump.b0ed9326.png",height:20,width:20,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAP1BMVEX68Gn+9WnSzf9YUf/6+v754wDLxf/43gD9+6hMaXH/////+JqqoP/Z1fv///qfmf3Buv3Wypzn5PtlXv/q4pwKMDo3AAAACnRSTlOqq/z++y78K/wAdqsI0AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAD9JREFUeJwVykEWwBAMBcBPQ5IfinL/s/bZzWLgmtZK6ijGZ9AKQPl6JhB8axuMi7Y7A2CdIgTU8uTNrjgB9R9PPgIuZE1rngAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},B={src:"/Game_jams/CactuJam-13/out/_next/static/media/powerup-widePlatforms.5e271ea2.png",height:20,width:20,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAALVBMVEX/+qH34gD88mn7/P9MaXHr6v9fT//68Wvp35n////e2v+fjuehk+zft1ndvXwZLxa3AAAACXRSTlP+LKv8APn+qf7FgXUKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAANklEQVR4nEXLNxIAIAwEsbVNOhP+/1wqhl6imINbwZAkjK6QQh3y7H0SRltzrjbwrBE1/ePXLzIQAV1GJdqTAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},U=A(["doubleJump","widePlatforms"]);class I extends k{update(e,t){return super.update(e,t)}constructor(e,t,i,s={}){super(e,t,{...s,width:20,height:20,labels:["powerup"],sprites:{doubleJump:{src:J.src},widePlatforms:{src:B.src}},defaultSprite:"doubleJump"===i?"doubleJump":"widePlatforms"}),this.owner=null,this.type=i}}let T={mayConfused:D("out/sounds/may-confused.wav"),gameOver1:D("out/sounds/game-over-1.wav"),gameOver2:D("out/sounds/game-over-2.wav"),jump1:D("out/sounds/jump-1.wav"),jump2:D("out/sounds/jump-2.wav"),may1:D("out/sounds/may-1.wav"),powerup:D("out/sounds/powerup.wav")};function D(e){if("undefined"==typeof Audio)return{};let t=new Audio(e);return t.preload="auto",t.load(),t}class F extends k{update(e,t){let i=y.isPressed("left","a"),s=y.isPressed("right","d"),a=y.isPressed("space","w","up"),r=y.isPressed("shiftleft","s","down"),l=(this.groundedOn?F.speed:F.fastSpeed)*e,o=(this.velocity.x<F.fastSlowingTriggerVelocity?F.fastSlowingSpeed:F.slowingSpeed)*e;if(this.flymode&&r&&(this.y+=50,this.points=0,this.combo=0),a&&this.groundedOn){if(this.flymode)this.y-=50;else{let e=y.isPressedOnce("2")&&this.getPowerup("doubleJump"),t=Math.random();this.groundedOn=!1;let i=Math.abs(this.velocity.x);this.velocity.y=i>50?-55:i>40?-50:i>25?-40:i>10?-33:-27,e&&(this.velocity.y*=2),t>.5?T.jump1.play():T.jump2.play()}}if(i?(this.velocity.x>0?this.velocity.x-=2*l:this.velocity.x-=l,this.velocity.x<-F.speedLimit&&(this.velocity.x=-F.speedLimit)):this.velocity.x<0&&(this.velocity.x>-o?this.velocity.x=0:this.velocity.x+=o),s?(this.velocity.x<0?this.velocity.x+=2*l:this.velocity.x+=l,this.velocity.x>F.speedLimit&&(this.velocity.x=F.speedLimit)):this.velocity.x>0&&(this.velocity.x<o?this.velocity.x=0:this.velocity.x-=o),t.reactions={terminator:()=>"game over",platform:(e,t)=>{let{entity:i}=e,{bottom:s}=t;if(i instanceof z&&s)return"".concat(i.floorIndex)},powerup:e=>{let{entity:t}=e;if(t instanceof I)return t.owner=this,this.powerups.push(t),T.powerup.play(),console.log("POWERUP GRABBED"),"powerum"}},this.velocity.y>0)this.sprite=this.moreSprites.falling;else if(0===this.velocity.x)this.sprite=this.moreSprites.idle;else{var n;this.sprite=this.moreSprites.moving;let e=Math.abs(this.velocity.x)>20?2:Math.abs(this.velocity.x)?5:10;this.updatesCount%e==0&&(null===(n=this.sprite)||void 0===n||n.nextFrame())}return super.update(e,t)}draw(e){let{ctx:t,...i}=e;super.draw({ctx:t,...i,scale:{x:-1*Math.sign(this.velocity.x)||1},inTranslationDrawer:()=>{this.flymode&&(t.beginPath(),t.arc(0,0,1.5*this.halfWidth,0,2*Math.PI),t.lineWidth=5,t.stroke())}})}getPowerup(e){let t=this.powerups.findIndex(t=>t.type===e);if(-1===t)return null;let i=this.powerups[t];return this.powerups=[...this.powerups.slice(0,t),...this.powerups.slice(t+1)],i}toggleFlyMode(){this.flymode=!this.flymode,this.groundedOn=this.flymode,this.velocity.y=0}setNewHigherFloor(e){if(this.higherFloor!==e){let t=e-this.higherFloor;t>1?this.combo+=t:(this.points+=this.combo**2*10,this.combo=0)}return!(this.higherFloor>=e)&&(this.points+=(e-this.higherFloor)**2*10,this.higherFloor=e,!0)}constructor(e,t,i={}){super(e,t,{...i,labels:["player"],sprites:{idle:{src:N.src},falling:{src:G.src},moving:{src:R.src,framesCount:3,framesPerColumn:2,framesPerRow:2}},defaultSprite:"idle",width:30,height:30}),this.flymode=!1,this.higherFloor=0,this.points=0,this.combo=0,this.powerups=[],this.groundedOn=!1}}F.speed=.3,F.fastSpeed=1,F.slowingSpeed=.3,F.fastSlowingSpeed=1,F.fastSlowingTriggerVelocity=5,F.speedLimit=200;class V{getLookingAtTranslate(e,t,i,s){if(!this.lookingAt)return{x:i,y:s};if(this.lookingAt===e){let e=screen.height/4;s-this.memoozedPosition.y<e?this.memoozedPosition.y=s-e:s-this.memoozedPosition.y>t.height-e&&(this.memoozedPosition.y=s-(t.height-e))}return{x:i,y:s-Math.min(0,this.memoozedPosition.y)}}constructor({lookingAt:e=null}={}){this.memoozedPosition={x:0,y:0},this.lookingAt=e}}function K(e,t){return e=Math.ceil(e),Math.floor(Math.random()*((t=Math.floor(t))-e+1))+e}let Q={src:"/Game_jams/CactuJam-13/out/_next/static/media/may.ffee381f.png"};class q extends k{update(e,t){var i;return this.groundedOn&&(this.groundedOn=!1,this.velocity.y=K(-15,-10)),1>Math.abs(this.velocity.x)&&(this.velocity.x=K(1,6)*Math.sign(this.velocity.x||Math.random()-.5)),this.updatesCount%10==0&&(null===(i=this.sprite)||void 0===i||i.nextFrame()),super.update(e,t)}constructor(e,t,i={}){super(e,t,{...i,labels:["terminator","enemy","may"],sprites:{may:{src:Q.src,framesCount:4,framesPerColumn:2,framesPerRow:2}},width:50,height:50,defaultSprite:"may"}),this.gravity=.9}}A(["SETUP","HOME","HOME->GAMEPLAY","GAMEPLAY","GAME-OVER"]);class X{async setup(){console.log("Setup");let{ctx:e,sizes:t}=this;this.state="GAMEPLAY";let i=window.localStorage.getItem("higher-score-record");this.higherScore=i?Number(i):0,t.leftBorderWidth=100,t.fullWidth=e.canvas.width,t.width=t.fullWidth-t.leftBorderWidth,t.halfWidth=t.width/2,t.height=e.canvas.height,t.halfHeight=t.height/2,E.sizeMultiplier=3;let s=t.width,a=t.height;t.floorsGap=200,t.wallSize=10,t.wallHoleAfterPlatforms=5,t.floorsHole=1,t.wallHeight=t.floorsGap*t.wallHoleAfterPlatforms,this.entities.powerups=[],this.entities.platforms=[new z(s/2,a-t.wallSize,s/E.sizeMultiplier,2*t.wallSize/E.sizeMultiplier,0)],this.entities.characters=[new F(120,t.height-150)],this.entities.walls=[new O(s-t.wallSize,a-t.wallHeight/2-this.entities.platforms[0].halfHeight-t.floorsGap/2,2*t.wallSize/E.sizeMultiplier,t.wallHeight/E.sizeMultiplier+t.floorsGap/3),new O(t.wallSize,a-t.wallHeight/2-this.entities.platforms[0].halfHeight,2*t.wallSize/E.sizeMultiplier,t.wallHeight/E.sizeMultiplier)],this.entities.enemies=[new H(s/2,3*a,s/E.sizeMultiplier,t.height/E.sizeMultiplier)],Array.from({length:3}).forEach(()=>this.entities.enemies.push(new q(K(100,s-100),this.entities.enemies[0].y-this.entities.enemies[0].halfHeight-50))),this.camera=new V({lookingAt:this.entities.characters[0]});let r=Object.values(this.entities).flatMap(e=>e.map(e=>new Promise(t=>e.sprite?e.sprite.onLoad(()=>t(!0)):t(!0)))),l=Object.values(T).map(e=>new Promise(t=>e.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA?t(e):e.addEventListener("canplay",()=>t(e))));this.uiManager.updateUi({}),console.log("await"),await Promise.all([...r,...l]),console.log("Setup done")}setState(e){"GAME-OVER"===e&&(Math.random()>.5?T.gameOver1.play():T.gameOver2.play()),this.state=e,this.uiManager.updateUi({})}update(e){var t,i,s;if("GAMEPLAY"!==this.state)return;let{ctx:a,sizes:r,entities:l,camera:o}=this,n=o.lookingAt;if(!n)return;if(y.isPressedOnce("r"))return this.setup();y.isPressedOnce("g")&&n instanceof F&&n.toggleFlyMode(),a.clearRect(0,0,r.fullWidth,r.height);let h={ctx:a,camera:o,translate:{x:r.leftBorderWidth}},d=l.enemies[0],c=d.y-d.halfHeight,u=y.isPressedOnce("1")&&n.getPowerup("widePlatforms");for(let t of(l.walls=l.walls.filter(t=>!(t.y>d.y+2*d.halfHeight)&&(t.update(e),t.draw(h),!0)),l.platforms=l.platforms.filter(t=>!(t.y>d.y+d.halfHeight)&&(t.y>c&&(t.x=2e3),u&&(t.w*=2),t.update(e),t.draw(h),!0)),l.powerups=l.powerups.filter(t=>(t.update(e),!t.owner&&(t.draw(h),!0))),l.enemies))t instanceof q?(t.y>c&&(t.groundedOn=d,t.y=c-t.halfHeight),(t.x<2*t.halfWidth||t.x>r.width-2*t.halfWidth)&&(t.velocity.x*=-1),t.update(e,{surroundingSolids:[d,...l.platforms]})):t instanceof H&&(n.y<r.height/2&&(t.velocity.y=-1.5-.5*Math.floor(n.higherFloor/50)),n.y-t.y<-(3*r.height)&&(t.y=n.y+3*r.height),t.update(e)),t.draw(h);for(let i of l.characters){let s=null!==(t=i.update(e,{surroundingSolids:[...l.platforms,...l.walls,...l.powerups,...l.enemies]}))&&void 0!==t?t:{};"powerup"in s&&this.uiManager.updateUi({}),("terminator"in s||n.y>c)&&this.setState("GAME-OVER"),"platform"in s&&n instanceof F&&s.platform&&n.setNewHigherFloor(Number(s.platform))&&this.uiManager.updateUi({}),n.points>this.higherScore&&(this.higherScore=n.points,window.localStorage.setItem("higher-score-record","".concat(this.higherScore))),i.draw(h)}let p=null!==(i=l.platforms.at(-5))&&void 0!==i?i:l.platforms[0];if(n.y<p.y+r.halfHeight){let e=l.platforms.at(-1).floorIndex+1,t=e%r.wallHoleAfterPlatforms==0,i=l.platforms.at(-1).y-r.floorsGap,s=Math.random();!t&&s<.05&&(console.log("POWERUP SPAWN"),l.powerups.push(new I(K(50,r.width-50),i,s<1/33?U.widePlatforms:U.doubleJump))),console.log("PLATFORM SPAWN ".concat(e)),l.platforms.push(new z(t?r.width/2:K(170,r.width-170),i,t?r.halfWidth/E.sizeMultiplier*2-20:K(90,150),2*r.wallSize/E.sizeMultiplier,e))}let g=null!==(s=l.walls.at(-1))&&void 0!==s?s:l.walls[0];if(n.y<g.y){console.log("WALL SPAWN");let e=g.y-g.halfHeight;l.walls.push(new O(r.width-r.wallSize,e,2*r.wallSize/E.sizeMultiplier,r.floorsGap/E.sizeMultiplier*r.wallHoleAfterPlatforms),new O(r.wallSize,e,2*r.wallSize/E.sizeMultiplier,r.floorsGap/E.sizeMultiplier*r.wallHoleAfterPlatforms))}}constructor(e){this.uiData={},this.sizes={leftBorderWidth:0,width:0,fullWidth:0,halfWidth:0,height:0,halfHeight:0,wallSize:0,wallHeight:0,floorsGap:0,floorsHole:0,wallHoleAfterPlatforms:0},this.entities={walls:[],platforms:[],characters:[],enemies:[],powerups:[]},this.camera=new V,this.state="SETUP",this.higherScore=0,this.uiManager=new g(e),this.ctx=this.uiManager.registerCtx("main","canvas"),this.setup().then(()=>this.uiManager.startLoop(e=>this.update(e))),window.game=this}}var Y=i(8428),Z=i.n(Y);function $(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.reduce((e,t)=>t&&"string"==typeof t?"".concat(e," ").concat(t.trim()):e,"").trim()||void 0}(...t)}var ee=i(5565),et=i(8173),ei=i.n(et);function es(e){let{children:t,disabled:i,body:a,style:r,ariaLabel:l,ariaCurrent:o,rel:n,className:h,href:d,download:c,target:u,onClick:p,formAction:g,buttonType:A,locale:m}=e;t||(t=a);let f={className:h,children:t},w=$("as-a",h);if(i)return(0,s.jsx)("span",{...f,className:w,"aria-disabled":"true"});if(p||g)return(0,s.jsx)("button",{type:A,...f,className:w,onClick:p,formAction:g});if(!d)return(0,s.jsx)("span",{...f,className:w});let y={...f,"aria-label":l,"aria-current":o||void 0,download:c,rel:n,target:u,href:d,style:r};return c||/^https?:\/\/|^\w+:/.test(d)?(0,s.jsx)("a",{...y}):(0,s.jsx)(ei(),{...y,locale:m})}i(2802);var ea=i(8541),er=i.n(ea);function el(e){let{className:t,id:i,fill:a,href:r,src:l,alt:o,priority:n,quality:h,width:d,height:c,aspectRatio:u,inline:p,wrapperStyle:g={},style:A,align:m}=e;m&&"left"!==m&&("float left"===m?g.float="left":"float right"===m?g.float="right":"center"===m?g.justifyContent="center":"right"===m&&(g.justifyContent="right"));let f=null,w={className:$(er().img,t),style:A,alt:o,src:l,id:i};p&&(f=(0,s.jsx)("img",{...w,className:er().inlineImg,loading:"lazy"}));let y={width:"number"!=typeof d?d:Math.round(d),height:"number"!=typeof c?c:Math.round(c)};if(y.width||y.height){let{width:e,height:t}=y;f=u||e&&t?(0,s.jsx)(ee.default,{...w,style:e?{height:"unset",...A}:{width:"unset",...A},width:e?Math.round(e):t&&u?t/u:void 0,height:t?Math.round(t):e&&u?e*u:void 0,quality:h,priority:n}):(0,s.jsx)("img",{...w,style:A,loading:"lazy",width:e,height:t})}return(a&&(f=(0,s.jsx)(ee.default,{...w,fill:!0,quality:h,priority:n})),null!=f||(f=(0,s.jsx)("img",{...w,style:A,loading:"lazy"})),r&&(f=(0,s.jsx)(es,{href:r,children:f})),Object.keys(g).length)?(0,s.jsx)("figure",{className:er().imageWrapper,style:g,children:f}):f}let eo=["stretch"];function en(e){return"number"==typeof e?"calc( var( --gap ) * ".concat(e," )"):"string"==typeof e?e:!0===e?"var( --gap )":void 0}let eh=(0,o.forwardRef)(function(e,t){return(0,o.useEffect)(()=>{if(!e.onKey)return;let t=t=>{var i;e.onKey===t.key&&(t.preventDefault(),t.stopPropagation(),null===(i=e.onClick)||void 0===i||i.call(e))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e.onKey,e.onClick]),(0,s.jsx)("button",{ref:t,type:e.type,children:e.children,className:e.className,style:e.style,disabled:e.disabled,onClick:e.onClick||void 0,"aria-disabled":!!e.disabled||void 0,"aria-current":e.ariaCurrent,"aria-label":e.ariaLabel})});var ed=i(3950),ec=i.n(ed);let eu=(0,o.forwardRef)(function(e,t){let i=e.children||e.body,a={ariaDisabled:!!e.disabled||void 0,ariaCurrent:e.ariaCurrent,ariaLabel:e.ariaLabel},r={children:i,className:"object"==typeof e.className?e.className.override:$(ec().button,e.className),style:e.style};return((e.wide||e.width)&&(r.style||(r.style={}),r.style.width=e.wide?"100%":e.width),e.gap&&(r.style||(r.style={}),r.style.gap=en(e.gap)),e.for)?(0,s.jsx)("label",{ref:t,...r,htmlFor:e.for,onClick:e.onClick||void 0,"aria-label":a.ariaLabel,"aria-disabled":a.ariaDisabled}):e.formAction?(0,s.jsx)("button",{ref:t,type:e.type,...r,formAction:e.formAction}):!e.href&&(e.formAction||e.onClick||e.type)?(0,s.jsx)(eh,{ref:t,type:e.type,...r,...a,onKey:e.onKey,disabled:e.disabled,onClick:e.onClick||void 0}):!e.href||e.disabled?(0,s.jsx)("div",{ref:t,...r,"aria-label":a.ariaLabel,"aria-disabled":a.ariaDisabled}):e.download||/^https?:\/\/|^\w+:/.test(e.href)?(0,s.jsx)("a",{...r,rel:e.linkRel,href:e.href,download:e.download}):(0,s.jsx)(ei(),{ref:t,...r,"aria-disabled":a.ariaDisabled,rel:e.linkRel,target:e.target,href:e.href,download:e.download})});async function ep(e){await new Promise(t=>setTimeout(t,1e3*e))}let eg={src:"/Game_jams/CactuJam-13/out/_next/static/media/homescreen.5e573286.png",height:213,width:213,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAaVBMVEUgyycepSYuqyOO2v4SqiKF2PfDsQsrzisbwSKF1/M7v4As2DQCuRuB2f0jnxIkt1KPzdSR1eXRrAAfuSdLxRw4yVSgzNPovlJ1t3VYt41bvBrFx5Fwx0iaxaRPq2y6riWWupurtlmyuVAjpgQxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARElEQVR4nAXBhQGAMBAEsKt+3XAv7D8kCZSqs1XW4urHUqIQ+N665uwc9BPvFIJE02VLUjLodk6c8QG0j94TAQYEwJgfg9oDLVGbJcYAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},eA={src:"/Game_jams/CactuJam-13/out/_next/static/media/homescreen-player.84843f2d.png",height:95,width:60,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAICAMAAAAGL8UJAAAANlBMVEU1AAB9CgAAAACbDgABAAAAAAAAAABMaXHBEQAAAAAAAACjDQCJDACgDQCVDAAFAAAAAACxDwC7oxeTAAAAEHRSTlMK4pH+V3oYAP7orcv8YVCSdvIMywAAAAlwSFlzAAALEwAACxMBAJqcGAAAAC9JREFUeJwdxMcNACAMBMEl2uSj/2aRmMdg5FKxKBVoUv8fLKtVjBAWDHdn3+TzAR3HAUntVniYAAAAAElFTkSuQmCC",blurWidth:5,blurHeight:8},em={src:"/Game_jams/CactuJam-13/out/_next/static/media/background-temple.0e3bac28.png"},ef={src:"/Game_jams/CactuJam-13/out/_next/static/media/screen-gameOver.c0a70198.png",height:213,width:213,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAVFBMVEWG2PaPsySkse9dvoaI2O6J3v1nsRggyCQewCSB2/WN0/q/4H5svp07uTZt07Amzy6bsQ2wvLnkrwD1x67ixJOijVRNx3KTq5SWkdSGzOT/6QCT2do4FntKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPklEQVR4nCXGxw3AMBADMLlKZ6f3sv+eAWK+iKeiqW9siUhmf+7L+2JAOfdtnZEQDre4MHQg85RFQRzJXvoAP9AB/oynBNsAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8};var ew=i(1160),ey=i.n(ew);function ev(e){let{as:t="div",className:i,style:a,children:r,align:l,verticallAlign:o,gap:n,wrap:h}=e,d=!!l&&eo.includes(l),c="object"==typeof i?$(i.override):$(d?ey().stretchedRow:ey().row,i),u={...a,gap:en(n),flexWrap:!0===h?"wrap":!1===h?void 0:null==a?void 0:a.flexWrap};return l&&!d&&(u.justifyContent=l),o&&(u.alignItems=o),(0,s.jsx)(t,{className:c,style:u,children:r})}function ex(){var e;let[t,i]=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=(0,o.useRef)(null),[s,a]=(0,o.useState)(0),[,r]=(0,o.useReducer)((e,t)=>t,{});return[(0,o.useCallback)(s=>{var l,o;s?(i.current=e(s),null===(l=i.current)||void 0===l||l.uiManager.setUIUpdater(e=>r(e)),t&&(window.game=i.current),a(e=>e+1)):(null===(o=i.current)||void 0===o||o.uiManager.dispose(),i.current=null,t&&(window.game=void 0))},[]),i.current,s]}(e=>new X(e)),a=null==i?void 0:i.camera.lookingAt,r=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return i&&t.includes(i.state)?void 0:{visibility:"hidden"}},l=async()=>{i&&(i.setState("HOME->GAMEPLAY"),await ep(2),T.mayConfused.play(),await ep(3),i.setState("GAMEPLAY"))};return(0,s.jsxs)("article",{ref:t,className:Z().game,"data-state":null==i?void 0:i.state,children:[(0,s.jsxs)("section",{className:$(Z().screen,(null==i?void 0:i.state)==="HOME->GAMEPLAY"&&Z().homeToGameplay),style:r("HOME","HOME->GAMEPLAY"),children:[(0,s.jsx)(el,{...eg,className:Z().screenBgr,alt:"Home screen"}),(0,s.jsx)(el,{...eA,className:Z().homeScreenPlayer,alt:"Home screen player"}),(0,s.jsxs)("nav",{className:Z().homeScreenNav,children:[(0,s.jsx)("h1",{children:"Wielkie Porwanie Majowego Ciasta"}),(0,s.jsx)(eu,{onClick:()=>l(),children:"START"})]})]}),(0,s.jsxs)("section",{className:$(Z().gameplayScreen,Z().screen),style:r("GAMEPLAY"),children:[(0,s.jsx)("canvas",{className:Z().canvas,style:{backgroundImage:"url( ".concat(em.src," )")}}),(0,s.jsx)("footer",{className:Z().ui,children:a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Najlepszy wynik:"}),(0,s.jsx)("p",{style:{textAlign:"right"},children:null==i?void 0:i.higherScore})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Punkty:"}),(0,s.jsx)("p",{style:{textAlign:"right"},children:a.points})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Obecne combo:"}),(0,s.jsx)("p",{style:{textAlign:"right"},children:a.combo})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Najwyższe piętro:"}),(0,s.jsx)("p",{style:{textAlign:"right"},children:a.higherFloor})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Prędkość pogoni:"}),(0,s.jsxs)("p",{style:{textAlign:"right"},children:[10*Math.abs(null!==(e=null==i?void 0:i.entities.enemies[0].velocity.y)&&void 0!==e?e:0),"km/h"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Modyfikatory:"}),(0,s.jsxs)(ev,{gap:"1em",children:[(0,s.jsx)(el,{...J,width:20,height:20,alt:"Double jump icon"}),a.powerups.filter(e=>"doubleJump"===e.type).length]}),(0,s.jsxs)(ev,{gap:"1em",children:[(0,s.jsx)(el,{...B,width:20,height:20,alt:"Wide platforms icon"}),a.powerups.filter(e=>"widePlatforms"===e.type).length]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Sterowanie:"}),(0,s.jsx)("br",{}),(0,s.jsxs)("p",{style:{paddingLeft:15},children:["Poruszanie:",(0,s.jsx)("br",{})," W/S/A/D",(0,s.jsx)("br",{}),"strzałki",(0,s.jsx)("br",{}),"spacja"]}),(0,s.jsx)("br",{}),(0,s.jsxs)("p",{style:{paddingLeft:15},children:["Modyfikatory:",(0,s.jsx)("br",{})," klawisze 1/2"]}),(0,s.jsx)("br",{}),(0,s.jsxs)("p",{style:{paddingLeft:15},children:["Restart:",(0,s.jsx)("br",{})," klawisz r"]})]})]})})]}),(0,s.jsxs)("section",{className:$(Z().screen),style:r("GAME-OVER"),children:[(0,s.jsx)(el,{...ef,className:Z().screenBgr,alt:"Game over screen"}),(0,s.jsxs)("nav",{className:Z().homeScreenNav,children:[(0,s.jsx)("p",{children:"I tak oto, Majowie przygotowali kolejny wypiek składany w ofierze"}),(0,s.jsx)(eu,{onClick:()=>null==i?void 0:i.setup(),children:"RESTART"})]})]})]})}},2802:()=>{},8428:e=>{e.exports={game:"CactuJam13_game__SvVSl",screen:"CactuJam13_screen___hF1J",screenBgr:"CactuJam13_screenBgr__3Ag3Q",homeToGameplay:"CactuJam13_homeToGameplay__F5K_O","homeScreen-blackScreen":"CactuJam13_homeScreen-blackScreen__z2HJB",homeScreenNav:"CactuJam13_homeScreenNav__y4cNb",homeScreenPlayer:"CactuJam13_homeScreenPlayer__AL9A7","homeScreen-leavingPlayer":"CactuJam13_homeScreen-leavingPlayer__24GCj",gameplayScreen:"CactuJam13_gameplayScreen__9lg__",canvas:"CactuJam13_canvas__GurzQ",ui:"CactuJam13_ui__IH0Ce"}},3950:e=>{e.exports={button:"Button_button__Jy2Uk"}},1160:e=>{e.exports={stretchedRow:"flow_stretchedRow__vrWCC",row:"flow_row__qDrAP",verticallyAlignedColumn:"flow_verticallyAlignedColumn___d_8Q",grid:"flow_grid__YLgJy",isAligningRight:"flow_isAligningRight__mdjTX",isAligningLeft:"flow_isAligningLeft__Cvobe",isAligningCenter:"flow_isAligningCenter__329mn"}},8541:e=>{e.exports={imageWrapper:"image_imageWrapper__ysb_l"}}},e=>{var t=t=>e(e.s=t);e.O(0,[148,165,441,517,358],()=>t(361)),_N_E=e.O()}]);