(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(4709)}])},4709:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return re}});var n=i(5893),r=i(4326),o=i(7294),s=i(9815);function l(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t.reduce((function(e,t){return t&&"string"===typeof t?"".concat(e," ").concat(t.trim()):e}),"").trim();return n.length?n:void 0}function a(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return l.apply(void 0,(0,s.Z)(t))}var d=i(828),c=i(6042),u=function(e,t){return{"&::before":(0,c.Z)({content:'""',display:"block",position:"absolute",inset:0,borderWidth:0,borderStyle:"solid",borderColor:e.colors.positive+"aa"},t),"&::after":(0,c.Z)({content:'""',display:"block",position:"absolute",inset:0,borderWidth:0,borderStyle:"solid",borderColor:e.colors.negative+"aa"},t)}},h=(0,r.Rk)((function(e){var t=e.atoms;return{"@keyframes shift-before":{"0%":{transform:"translate( 0, 0 )"},"5%":{transform:"translate( 2px, 2px )"},"10%":{transform:"translate( 0, 0 )"},"100%":{transform:"translate( 0, 0 )"}},"@keyframes shift-after":{"0%":{transform:"translate( 0, 0 )"},"5%":{transform:"translate( -2px, -2px )"},"10%":{transform:"translate( 0, 0 )"},"100%":{transform:"translate( 0, 0 )"}},gameStartScreen:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:t.colors.positive,height:"100dvh"},colorsSetters:{margin:"0 auto",width:"max-content"},colorSetter:{display:"flex",gap:t.spacing.main,marginBlock:t.spacing.main},colorBox:{width:50,height:25,"body &::before":{inset:-5,animation:"10s infinite ease-in-out",animationDelay:"2s",animationName:"$shift-before"},"body &::after":{inset:-5,animation:"10s infinite ease-in-out",animationDelay:"2s",animationName:"$shift-after"}},gameUi:{display:"grid",gridTemplateColumns:"200px 1fr 200px",width:"100%",height:"100dvh"},column:{padding:t.spacing.small,"&.is-positive":{color:t.colors.positive},"&.is-negative":{color:t.colors.positive}},canvasesWrapper:(0,c.Z)({position:"relative"},u(t,{borderLeftWidth:t.sizes.border.width,borderRightWidth:t.sizes.border.width})),canvas:{position:"absolute",left:t.sizes.border.width,top:0,width:"calc( 100% - ".concat(2*t.sizes.border.width,"px )"),height:"100%"},avatar:{width:"100%",aspectRatio:1},frame:(0,c.Z)({position:"relative"},u(t,{borderWidth:t.sizes.border.width})),stats:{padding:0,"dl&":{display:"grid",gridTemplateColumns:"1fr 1fr",alignItems:"center",gap:t.spacing.main},"& > dt":{textAlign:"right"},"& > dd":{textAlign:"left",margin:0},"& > li":{textAlign:"left",listStyle:"none",margin:t.spacing.main}}}})),v=i(1438),f=i(8029),g=i(6567),p=i(849),y=i(5427),x=i(9396),m=function(e){return"x"in e&&"y"in e},w=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this;(0,v.Z)(this,e),this.tags=new Set,this.color=t,i.forEach((function(e){return n.tags.add(e)}))},b=function(){function e(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];(0,v.Z)(this,e),this.tags=new Set,this.items=[],this.items=i}var t=e.prototype;return t.push=function(e){this.items.push(e)},t.clear=function(){this.items=[]},t.clone=function(e){this.items=(0,s.Z)(e.items)},t.getTop=function(){var e;return null!==(e=this.items[this.items.length-1])&&void 0!==e?e:null},e}(),k=new WeakSet,j=function(){function e(t){(0,v.Z)(this,e),(0,y.Z)(this,k),this.levelDimensions={x:200,y:600},this.levelData=[],this.cellSize=5,this.lastPlayerPos={x:-1,y:-1},this.entities=[],this.drawOffset={x:0,y:0},this.colors=t,this.processLevelData(T)}var t=e.prototype;return t.processLevelData=function(e){var t=this;this.levelData=Array.from({length:this.levelDimensions.y},(function(){return[]})),e.forEach((function(e){var i=function(){return new w(t.getColor(e.color),e.tags)};!function(e){return m(e)&&"w"in e&&"h"in e}(e)?!function(e){return m(e)&&"w"in e}(e)?!function(e){return m(e)&&"h"in e}(e)?m(e)&&(t.setCellItem(e.x,e.y,i()),function(e){return m(e)&&e.tags.includes("player")}(e)&&(t.lastPlayerPos.x=e.x,t.lastPlayerPos.y=e.y)):t.setVerticalLine(e.x,e.y,e.h,i):t.setHorizontalLine(e.x,e.y,e.w,i):t.setRect(e.x,e.y,e.w,e.h,i)}))},t.draw=function(e){var t=this,i=this,n=i.levelData,r=i.levelDimensions,o=i.drawOffset,s=this.getCtxDimensions(e),l=s.width,a=s.height,d=s.center,c=l/r.x,u=Math.floor(a/c);e.clearRect(0,0,l,a),e.save(),e.translate(d.x-(r.x+o.x)*c/2,a-(r.y-o.y)*c);var h=r.y-o.y-u;n.slice(h,r.y-o.y).forEach((function(i,n){return i.forEach((function(i,r){return i.items.forEach((function(i){if(i){var o=h+n;if(i.tags.has("border")){var s=c/4;e.fillStyle="".concat(t.colors.safe,"aa"),e.fillRect(r*c-s,o*c-s,c,c),e.fillStyle="".concat(t.colors.danger,"aa"),e.fillRect(r*c+s,o*c+s,c,c)}else e.fillStyle=i.color,e.fillRect(r*c,o*c,c,c)}}))}))})),e.restore()},t.logic=function(e){var t=this.getCtxDimensions(e),i=t.width,n=t.height,r=t.center,o=this.getPlayerTileInfo(),s=this.levelDimensions,l=this.drawOffset,a=i/s.x,d=o.y-l.y-r.y/a,c=Math.floor(n/a),u=l.y,h=s.y-c-l.y;u>0&&d<-25&&this.drawOffset.y--,h>0&&d>25&&this.drawOffset.y++},t.createTile=function(e,t,i){"danger"===i&&this.entities.push({x:e,y:t,tags:[i]}),this.setCellItem(e,t,new w(this.getColor(i),[i]))},t.getPlayerTileInfo=function(){var e,t,i=(0,x.Z)((0,c.Z)({},this.lastPlayerPos),{tile:null===(e=this.getCell(this.lastPlayerPos.x,this.lastPlayerPos.y))||void 0===e?void 0:e.getTop()});if(!(null===(t=i.tile)||void 0===t?void 0:t.tags.has("player"))){console.log("player losted");for(var n=0;n<this.levelData.length;++n)for(var r=0;r<this.levelData[n].length;++r){var o,s=null===(o=this.levelData[n][r])||void 0===o?void 0:o.getTop();if(null===s||void 0===s?void 0:s.tags.has("player")){this.lastPlayerPos.x=r,this.lastPlayerPos.y=n,i.x=r,i.y=n,i.tile=s;break}}}return i},t.removeEntity=function(e,t){var i,n=this.entities.findIndex((function(i){return i.x===e&&i.y===t}));-1!==n&&(this.entities.splice(n,1),null===(i=this.getCell(e,t))||void 0===i||i.clear())},t.moveEnemyBy=function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=r.withTeleportation,s=void 0!==o&&o,l=r.swapeableTags,a=void 0===l?["trail"]:l,d=this.entities.find((function(i){return i.x===e&&i.y===t}));if(d){var u=this.moveTileBy(d.x,d.y,i,n,{withTeleportation:s,swapeableTags:a});return u?(d.x+=i,d.y+=n,d.x<0?d.x=this.levelDimensions.x+d.x:d.x%=this.levelDimensions.x,d.y<0?d.y=this.levelDimensions.y+d.y:d.y%=this.levelDimensions.y,(0,x.Z)((0,c.Z)({},d),{swapedCell:u})):{collidingCell:this.getCell(d.x+i,d.y+n)}}},t.movePlayerBy=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.withTeleportation,r=void 0!==n&&n,o=i.swapeableTags,s=void 0===o?["trail","land","deep land"]:o,l=this.getPlayerTileInfo(),a=l.tile;if(a){var d=this.moveTileBy(this.lastPlayerPos.x,this.lastPlayerPos.y,e,t,{withTeleportation:r,swapeableTags:s});return d?(this.lastPlayerPos.x+=e,this.lastPlayerPos.y+=t,this.lastPlayerPos.x<0?this.lastPlayerPos.x=this.levelDimensions.x+this.lastPlayerPos.x:this.lastPlayerPos.x%=this.levelDimensions.x,this.lastPlayerPos.y<0?this.lastPlayerPos.y=this.levelDimensions.y+this.lastPlayerPos.y:this.lastPlayerPos.y%=this.levelDimensions.y,(0,x.Z)((0,c.Z)({},this.lastPlayerPos),{swapedCell:d})):{collidingCell:this.getCell(this.lastPlayerPos.x+e,this.lastPlayerPos.y+t)}}},t.moveTileBy=function(e,t,i,n){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=o.withTeleportation,l=void 0!==s&&s,a=o.swapeableTags,d=void 0===a?[]:a,c=this.getCell(e,t,l);if(!c)return!1;var u=this.getCell(e+i,t+n,l);if(!u)return!1;var h=null===(r=u.getTop())||void 0===r?void 0:r.tags;if(h&&d.length&&!d.some((function(e){return null===h||void 0===h?void 0:h.has(e)})))return!1;var v=new b;return v.clone(u),u.clone(c),c.clear(),v},t.getColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"land";return"land"===e?this.colors.safe:"player"===e?"".concat(this.colors.safe):"deep land"===e?"".concat(this.colors.safe,"aa"):"trail"===e?"".concat(this.colors.safe,"77"):"danger"===e?"".concat(this.colors.danger,"aa"):e},t.getCtxDimensions=function(e){return{width:e.canvas.width,height:e.canvas.height,center:{x:e.canvas.width/2,y:e.canvas.height/2}}},t.getCellNeighbours=function(e,t){var i,n,r,o,s,l,a,d,c,u,h,v,f,g,p,y,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=this.getRow(t),w=this.getRow(t+1),b=this.getRow(t-1),k={north:null!==(s=null===w||void 0===w||null===(i=w[e])||void 0===i?void 0:i.getTop())&&void 0!==s?s:null,east:null!==(l=null===m||void 0===m||null===(n=m[e+1])||void 0===n?void 0:n.getTop())&&void 0!==l?l:null,south:null!==(a=null===b||void 0===b||null===(r=b[e])||void 0===r?void 0:r.getTop())&&void 0!==a?a:null,west:null!==(d=null===m||void 0===m||null===(o=m[e-1])||void 0===o?void 0:o.getTop())&&void 0!==d?d:null};x&&(k.northEast=null!==(f=null===w||void 0===w||null===(c=w[e+1])||void 0===c?void 0:c.getTop())&&void 0!==f?f:null,k.southEast=null!==(g=null===b||void 0===b||null===(u=b[e+1])||void 0===u?void 0:u.getTop())&&void 0!==g?g:null,k.southWest=null!==(p=null===b||void 0===b||null===(h=b[e-1])||void 0===h?void 0:h.getTop())&&void 0!==p?p:null,k.northWest=null!==(y=null===w||void 0===w||null===(v=w[e-1])||void 0===v?void 0:v.getTop())&&void 0!==y?y:null);return k},t.fillArea=function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1e3,s=this,l=[],a=(0,p.Z)(this,k,Z).call(this,e,t,i,n,r,o,l);return a?(l.forEach((function(t){var i,n=t.x,r=t.y,o=t.createTile,l=s.getCell(n,r);l&&(l.tags.delete(e),(null===(i=l.getTop())||void 0===i?void 0:i.tags.has("danger"))&&s.removeEntity(n,r),l.clear(),o&&l.push(o(n,r)))})),l.length):(l.forEach((function(t){var i,n=t.x,r=t.y;return null===(i=s.getCell(n,r))||void 0===i?void 0:i.tags.delete(e)})),!1)},t.fillAreaWithLand=function(e,t){var i=this,n=Date.now(),r={terminatorTags:[["border",null]],acceptTags:[["danger",function(){return new w(i.getColor("deep land"),["deep land"])}]]};return this.fillArea("".concat(n),e,t,(function(){return new w(i.getColor("deep land"),["deep land"])}),r,2e3)},t.destroyFilledLand=function(e,t){var i=Date.now();return this.fillArea("".concat(i),e,t,void 0,{acceptTags:[["deep land",null]]},2e3)},t.removeTagged=function(e){for(var t=0;t<this.levelData.length;++t)for(var i=0;i<this.levelData[t].length;++i){var n,r=this.levelData[t][i];(null===(n=null===r||void 0===r?void 0:r.getTop())||void 0===n?void 0:n.tags.has(e))&&r.clear()}},t.getRow=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&(e<0||e>=this.levelDimensions.y))return null;var i,n=e%this.levelDimensions.y,r=n<0?-n-1:this.levelData.length-1-n;return null!==(i=this.levelData[r])&&void 0!==i?i:[]},t.getCell=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!i&&(e<0||e>=this.levelDimensions.x))return null;var n=this.getRow(t,i);if(!n)return null;var r=e%this.levelDimensions.x,o=r<0?this.levelDimensions.x+r:r;return n[o]||(n[o]=new b),n[o]},t.setCell=function(e,t){var i=this.getRow(t);i&&(i[e<0?i.length-e:e]=new b)},t.setCellItem=function(e,t,i){var n=this.getRow(t);if(n){var r=e<0?n.length-e:e;n[r]||(n[r]=new b),n[r].push(i)}},t.setHorizontalLine=function(e,t,i,n){var r=t<0?-t-1:this.levelData.length-t,o=this.levelData[r];if(o)for(var s=i<0?this.levelDimensions.x-i:i,l=e<0?o.length-e:e,a=0;a<s;++a)o[l+a]||(o[l+a]=new b),o[l+a].push(n(e,t))},t.setVerticalLine=function(e,t,i,n){for(var r=e<0?this.levelDimensions.x-e:e,o=0;o<i;++o){var s=this.getRow(t+o);s&&(s[r]||(s[r]=new b),s[r].push(n(e,t)))}},t.setRect=function(e,t,i,n,r){for(var o=e<0?this.levelDimensions.x-e:e,s=i<0?this.levelDimensions.x-i:i,l=0;l<n;++l){var a=this.getRow(t+l);if(a)for(var d=0;d<s;++d)a[o+d]||(a[o+d]=new b),a[o+d].push(r(e,t))}},e}();function Z(e,t,i,n){var r,o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=s.acceptTags,a=s.terminatorTags,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],h=this,v=null===(r=this.getCell(t,i))||void 0===r?void 0:r.getTop(),f=this.getRow(i),g="filling-".concat(e);if(!f||(null===(o=f[t])||void 0===o?void 0:o.tags.has(g)))return!0;if(u.length>c)return!1;if(i>this.levelData.length||i<0)return!1;if(v){if((null===a||void 0===a?void 0:a.length)&&a.some((function(e){var t=(0,d.Z)(e,1)[0];return v.tags.has(t)})))return!1;if((null===l||void 0===l?void 0:l.length)&&!l.some((function(e){var t=(0,d.Z)(e,1)[0];return v.tags.has(t)})))return!0}for(var y=function(t,i){var r=h.getCell(t,i);if(!r)return!1;if(r.tags.has(g))return!1;if(r.getTop()){var o,s,v=null===(o=r.getTop())||void 0===o?void 0:o.tags,f=null===(s=null===l||void 0===l?void 0:l.find((function(e){var t=(0,d.Z)(e,1)[0];return null===v||void 0===v?void 0:v.has(t)})))||void 0===s?void 0:s[1];if(void 0===f)return!1;u.push({x:t,y:i,createTile:f})}else u.push({x:t,y:i,createTile:n});r.tags.add(g);var y=(0,p.Z)(h,k,Z).call(h,e,t,i+1,n,{acceptTags:l,terminatorTags:a},c,u);return y&&(y=(0,p.Z)(h,k,Z).call(h,e,t,i-1,n,{acceptTags:l,terminatorTags:a},c,u))||null},x=t;x<this.levelDimensions.x;++x){if(u.length>c)return!1;var m=y(x,i);if(null===m)return!1;if(!m)break}for(var w=t-1;w>0;--w){if(u.length>c)return!1;var b=y(w,i);if(null===b)return!1;if(!b)break}return u.length<=c}var T=[{tags:["deep land"],x:0,y:-1,w:-1,h:1},{tags:["border","border-2"],x:0,y:450,w:-1,h:2},{tags:["border","border-1"],x:0,y:150,w:-1,h:2},{tags:["player"],color:"player",x:90,y:10},{tags:["city"],color:"land",x:0,y:0,w:-1,h:10}],C=i(5315),D=i(2221),P=i(8409),z=new WeakMap,A=new WeakMap,S=new WeakMap,I=new WeakSet,W=new WeakMap,R=function(){function e(t){var i=this;(0,v.Z)(this,e),(0,y.Z)(this,I),(0,D.Z)(this,z,{writable:!0,value:-1}),(0,D.Z)(this,A,{writable:!0,value:null}),(0,D.Z)(this,S,{writable:!0,value:!1}),this.ctxs=new Map,(0,D.Z)(this,W,{writable:!0,value:function(){i.ctxs.forEach((function(e){return(0,p.Z)(i,I,L).call(i,e.canvas)}))}}),this.root=t}var t=e.prototype;return t.enable=function(){window.addEventListener("resize",(0,C.Z)(this,W)),(0,C.Z)(this,W).call(this),this.startLoop()},t.disable=function(){window.removeEventListener("resize",(0,C.Z)(this,W)),this.stopLoop()},t.startLoop=function(){var e=this,t=function(){return requestAnimationFrame((function(){(0,C.Z)(e,S)||(e.logic(),e.draw(),(0,P.Z)(e,z,window.setTimeout(t,1e3/60)))}))};(0,P.Z)(this,S,!1),t()},t.stopLoop=function(){(0,P.Z)(this,S,!0),window.clearTimeout((0,C.Z)(this,z))},t.setUIUpdater=function(e){(0,P.Z)(this,A,e)},t.updateUi=function(){(0,C.Z)(this,A)&&(0,C.Z)(this,A).call(this,structuredClone(this.uiData))},t.registerCtx=function(e,t){var i="string"!==typeof t?t:this.root.querySelector(t),n=null===i||void 0===i?void 0:i.getContext("2d");if("string"===typeof t&&!i)throw new Error('Canvas "'.concat(e,'" not found with provided selector: "').concat(t,'"'));if(!n)throw new Error('Cannot create 2D context for "'.concat(e,'" canvas'));return this.ctxs.set(e,n),(0,p.Z)(this,I,L).call(this,n.canvas),n},e}();function L(e){e.width=e.clientWidth,e.height=e.clientHeight}var N=new WeakMap,E=new WeakMap,F=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,v.Z)(this,e),(0,D.Z)(this,N,{writable:!0,value:void 0}),(0,D.Z)(this,E,{writable:!0,value:void 0}),this.code=t,(0,P.Z)(this,N,i),(0,P.Z)(this,E,n)}var t=e.prototype;return t.setPressed=function(e){(0,C.Z)(this,N)!==e&&((0,P.Z)(this,E,!1),(0,P.Z)(this,N,e))},t.getPressed=function(){return(0,C.Z)(this,N)},t.getOnce=function(){return!(!(0,C.Z)(this,N)||(0,C.Z)(this,E))&&((0,P.Z)(this,E,!0),!0)},e}(),B=function(){function e(){(0,v.Z)(this,e)}var t=e.prototype;return t.isPressed=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=!0,o=!1,s=void 0;try{for(var l,a=i[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var d=l.value,c=e.keysMap.get(d.toLowerCase());if(null===c||void 0===c?void 0:c.getPressed())return!0}}catch(u){o=!0,s=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw s}}return!1},t.isPressedOnce=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=!0,o=!1,s=void 0;try{for(var l,a=i[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var d=l.value,c=e.keysMap.get(d.toLowerCase());if(null===c||void 0===c?void 0:c.getOnce())return!0}}catch(u){o=!0,s=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw s}}return!1},e}();B.keysMap=new Map;!function(){var e=window;e&&(e.addEventListener("keydown",(function(e){var t=e.code,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")&&(i=t.slice(5)),i=i.toLowerCase();var n=B.keysMap.get(i);n?n.setPressed(!0):B.keysMap.set(i,new F(i,!0))})),e.addEventListener("keyup",(function(e){var t=e.code,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")&&(i=t.slice(5)),i=i.toLowerCase();var n=B.keysMap.get(i);n?n.setPressed(!1):B.keysMap.set(i,new F(i,!1))})))}();var M=function(e){(0,f.Z)(i,e);var t=(0,g.Z)(i);function i(e,n){var r,o=n.colors;return(0,v.Z)(this,i),(r=t.call(this,e)).debug=!1,r.keys=new B,r.ticks=0,r.level=null,r.uiData={experience:0,speed:r.debug?9:1,knownAreas:0,knownTiles:0,closedAreas:0,stage:0,destroyedAreas:0,score:0,visibleScore:!1,gameOver:!1,expincomeGood:!1,tooBigAreaInfo:!1,borderReached:!1,usedW:!1,usedS:!1,usedA:!1,usedD:!1},r.enemyTimerId=null,r.colors=o,r.ctx=r.registerCtx("main","canvas"),r.runLevel(1),r.startLoop(),r}var n=i.prototype;return n.runLevel=function(e){1===e&&(this.level=new j(this.colors))},n.draw=function(){var e;null===(e=this.level)||void 0===e||e.draw(this.ctx)},n.logic=function(){var e=this,t=this,i=t.level,n=t.ticks,r=t.uiData;this.ticks++;var o=9-r.speed<0?0:9-r.speed,s=r.stage<9?9-r.stage:1;if(o&&n%o!==0||this.logicBySpeed(),i)if(i.logic(this.ctx),n%s===0&&i.entities.filter((function(e){return e.tags.includes("danger")})).forEach((function(t){var n=i.moveEnemyBy(t.x,t.y,0,-1);if(n&&"collidingCell"in n){var o,s,l=null===(s=null===(o=n.collidingCell)||void 0===o?void 0:o.getTop())||void 0===s?void 0:s.tags;if(null===l||void 0===l?void 0:l.has("deep land")){var a=i.destroyFilledLand(t.x,t.y-1);a&&(i.removeEntity(t.x,t.y),r.knownTiles-=a,r.destroyedAreas++,r.knownTiles<0&&(r.knownTiles=0),e.updateUi())}else(null===l||void 0===l?void 0:l.has("city"))&&(r.gameOver=!0,e.calcScore(),e.updateUi(),e.stopLoop())}})),2===r.stage){if(!this.enemyTimerId){this.enemyTimerId=window.setTimeout((function(){!function(){var e,t=function(e,t){return Math.floor(Math.random()*(t-e))+e},n=t(3,i.levelDimensions.x-3),r=t(100,400),o=i.getCell(n,r),s=null===(e=null===o||void 0===o?void 0:o.getTop())||void 0===e?void 0:e.tags;(null===s||void 0===s?void 0:s.has("deep land"))||i.createTile(n,r,"danger")}(),e.enemyTimerId=null}),7500)}}else if(3===r.stage&&!this.enemyTimerId&&!i.entities.length){this.enemyTimerId=window.setTimeout((function(){!function(){var t,n=function(e,t){return Math.floor(Math.random()*(t-e))+e},o=n(3,i.levelDimensions.x-3),s=n(150,600),l=i.getCell(o,s),a=null===(t=null===l||void 0===l?void 0:l.getTop())||void 0===t?void 0:t.tags;if(null===a||void 0===a?void 0:a.has("deep land")){var d=i.destroyFilledLand(o,s);d&&(r.knownTiles-=d,r.destroyedAreas++,r.knownTiles<0&&(r.knownTiles=0),e.updateUi())}else i.createTile(o,s,"danger")}(),e.enemyTimerId=null}),3e3)}},n.logicBySpeed=function(){var e=this,t=e.keys,i=e.level,n=e.uiData;if(i){var r=i.getPlayerTileInfo(),o=void 0;if(t.isPressed("w","up")&&(this.updateUiFlag("usedW"),o=i.movePlayerBy(0,1)),!o&&t.isPressed("s","down")&&(this.updateUiFlag("usedS"),o=i.movePlayerBy(0,-1)),!o&&t.isPressed("a","left")&&(this.updateUiFlag("usedA"),o=i.movePlayerBy(-1,0)),!o&&t.isPressed("d","right")&&(this.updateUiFlag("usedD"),o=i.movePlayerBy(1,0)),o&&"collidingCell"in o){var s,l,a=null===(l=null===(s=o.collidingCell)||void 0===s?void 0:s.getTop())||void 0===l?void 0:l.tags;(null===a||void 0===a?void 0:a.has("border"))&&(n.borderReached=!0),this.updateUi()}else if(o&&"swapedCell"in o){var d,c=null===(d=o.swapedCell)||void 0===d?void 0:d.getTop(),u=c&&c.tags.has("trail")||(null===c||void 0===c?void 0:c.tags.has("land"))||(null===c||void 0===c?void 0:c.tags.has("deep land"));u||(n.knownTiles++,this.updateUi()),i.createTile(r.x,r.y,"trail");var h=i.getCellNeighbours(o.x,o.y);if(!u&&Object.values(h).filter(Boolean).length>1){var v=!0,f=!1,g=void 0;try{for(var p,y=[{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:-1,y:0},{x:1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1}][Symbol.iterator]();!(v=(p=y.next()).done);v=!0){var x,m=p.value,w=m.x,b=m.y,k=i.getRow(o.y+b),j=0,Z=1/0;if(k&&!(null===(x=k[o.x+w])||void 0===x?void 0:x.getTop())){for(var T=o.x+w;T<i.levelDimensions.x;++T){var C,D,P=null===(D=null===(C=i.getCell(T,o.y+b))||void 0===C?void 0:C.getTop())||void 0===D?void 0:D.tags;((null===P||void 0===P?void 0:P.has("trail"))||(null===P||void 0===P?void 0:P.has("player")))&&(Z!=T-1&&j++,Z=T)}if(0!==j){for(var z=0;z<o.x+w;++z){var A,S,I=null===(S=null===(A=i.getCell(z,o.y+b))||void 0===A?void 0:A.getTop())||void 0===S?void 0:S.tags;((null===I||void 0===I?void 0:I.has("trail"))||(null===I||void 0===I?void 0:I.has("player")))&&(Z!=z-1&&j++,Z=z)}if(j>0){var W=i.fillAreaWithLand(o.x+w,o.y+b);if(W){var R=n.experience;n.knownAreas+=W,n.closedAreas++;for(var L=600;L<W;L+=600)n.expincomeGood=!0,n.experience++;1===n.closedAreas?(n.speed++,n.experience++):5===n.closedAreas?n.experience++:10===n.closedAreas?(n.speed++,n.experience++):20===n.closedAreas?n.experience++:40===n.closedAreas&&(n.speed++,n.experience++),n.experience-R>2&&(n.speed+=Math.floor((n.experience-R)/3)),this.debug?(R<2&&n.experience>=2&&(i.removeTagged("border-1"),n.stage=2,n.speed++),R<2&&n.experience>=2&&(i.removeTagged("border-1"),n.stage=2,n.speed++)):(n.stage<2&&R<=7&&n.experience>=7&&(i.removeTagged("border-1"),n.experience++,n.stage=2,n.speed++),2==n.stage&&n.knownAreas>14e3&&(n.visibleScore=!0,i.removeTagged("border-2"),n.experience++,n.stage=3,n.speed++));break}n.tooBigAreaInfo=!0,this.calcScore(),this.updateUi()}}}}}catch(N){f=!0,g=N}finally{try{v||null==y.return||y.return()}finally{if(f)throw g}}}}}},n.calcScore=function(){var e=this.uiData;e.score=Math.floor((20*e.closedAreas+1*e.knownAreas+10*e.knownTiles+100*e.experience)*(1+.05*e.stage))},n.updateUiFlag=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.uiData[e]!==t&&(this.uiData[e]=t,this.updateUi())},i}(R),O=(0,o.memo)((0,o.forwardRef)((function(e,t){var i=(0,d.Z)(h(),1)[0];return(0,n.jsx)("section",{ref:t,className:i.canvasesWrapper,children:(0,n.jsx)("canvas",{className:i.canvas})})})));function U(){var e=(0,d.Z)(h(),2),t=e[0],i=e[1].atoms,r=(0,d.Z)(function(e){var t=(0,o.useRef)(null),i=(0,o.useReducer)((function(e,t){return t}),{}),n=i[0],r=i[1];(0,o.useEffect)((function(){t.current}),[]);var s=(0,o.useCallback)((function(i){var n,o;i?(t.current=e(i),null===(n=t.current)||void 0===n||n.setUIUpdater((function(e){r(e)}))):(null===(o=t.current)||void 0===o||o.disable(),t.current=null)}),[]);return[s,n,t.current]}((function(e){return new M(e,{colors:{safe:i.colors.positive,danger:i.colors.negative}})})),2),s=r[0],l=r[1],c=l.knownAreas||l.knownTiles||l.closedAreas,u=l.usedW||l.usedS||l.usedA||l.usedD,v=l.usedW&&l.usedS&&l.usedA&&l.usedD;return(0,n.jsxs)("article",{className:t.gameUi,children:[(0,n.jsxs)("section",{className:a(t.column,"is-positive"),children:[(0,n.jsx)("div",{style:{minHeight:300},children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:"Statystyki"}),(0,n.jsxs)("dl",{className:t.stats,children:[!!l.closedAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zamkni\u0119tych obszar\xf3w"}),(0,n.jsx)("dd",{children:l.closedAreas})]}),!!l.knownAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zbadanych teren\xf3w"}),(0,n.jsx)("dd",{children:l.knownAreas})]}),!!l.knownTiles&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zwiedzonych p\xf3l"}),(0,n.jsx)("dd",{children:l.knownTiles})]}),!!l.experience&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Do\u015bwiadczenie"}),(0,n.jsx)("dd",{children:l.experience})]}),!!l.speed&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Pr\u0119dko\u015b\u0107 podr\xf3\u017cy"}),(0,n.jsx)("dd",{children:l.speed})]}),!!l.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Etap gry"}),(0,n.jsx)("dd",{children:l.stage})]}),!!l.destroyedAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Straconych obszar\xf3w"}),(0,n.jsx)("dd",{children:l.destroyedAreas})]}),!!l.visibleScore&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Punkty"}),(0,n.jsx)("dd",{children:l.score})]})]})]}):(0,n.jsx)("h3",{children:"Statystyki?"})}),(0,n.jsx)("div",{style:{minHeight:200},children:u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:"Informacje"}),(0,n.jsx)("dl",{className:t.stats,children:v?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Poruszanie"}),(0,n.jsxs)("dd",{children:["W, S, A, D,",(0,n.jsx)("br",{})," \u2191, \u2193, \u2190, \u2192"]})]}):[l.usedW&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"W, \u2191"]}),(0,n.jsx)("dd",{children:"Kierunek p\xf3\u0142nocy"})]},"KeyW"),l.usedS&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"S, \u2193"]}),(0,n.jsx)("dd",{children:"Kierunek po\u0142udniowy"})]},"KeyS"),l.usedA&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"A, \u2190"]}),(0,n.jsx)("dd",{children:"Kierunek zachodni"})]},"KeyA"),l.usedD&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"D, \u2192"]}),(0,n.jsx)("dd",{children:"Kierunek wschodni"})]},"KeyD")]}),(0,n.jsxs)("ol",{className:t.stats,children:[l.tooBigAreaInfo&&(0,n.jsx)("li",{children:"Zdaje si\u0119, \u017ce zbyt wielkie obszary nie mog\u0105 zosta\u0107 zbadane."}),l.tooBigAreaInfo&&l.expincomeGood&&(0,n.jsx)("li",{children:"Natomiast w pewnych granicach rozs\u0105dku co do rozmiaru badanego obszaru, mog\u0119 si\u0119 sporo nauczy\u0107."}),l.borderReached&&(0,n.jsx)("li",{children:"Dalej nie chc\u0119 wyp\u0142ywa\u0107 bez zdobycia wi\u0119kszje liczby do\u015bwiadczenia"}),l.gameOver&&(0,n.jsxs)("li",{children:["Gra zako\u0144czona. Zebrano ",l.score," punkt\xf3w"]})]})]}):(0,n.jsx)("h3",{children:"Informacje?"})})]}),(0,n.jsx)(O,{ref:s}),(0,n.jsx)("section",{className:a(t.column,"is-negative")})]})}var _=i(8620);var K=i(1664),H=i.n(K);function G(e){var t=e.children,i=e.body,r=e.variant,o=e.ariaLabel,s=e.ariaCurrent,l=e.rel,u=e.className,h=e.href;t||(t=i);var v=(0,d.Z)($(),1)[0],f={className:a("clean"===r?v.clearLink:v.link,u),"aria-label":o,"aria-current":s||void 0,children:t};return h?/https?:\/\//.test(h)?(0,n.jsx)("a",(0,x.Z)((0,c.Z)({},f),{rel:l,href:h})):(0,n.jsx)(H(),(0,x.Z)((0,c.Z)({},f),{rel:l,href:h})):(0,n.jsx)("span",(0,c.Z)({},f))}var $=(0,_.Z)((function(e){var t=e.components;return{link:(0,c.Z)({color:"inherit",textDecoration:"none"},t.Link),clearLink:{color:"inherit",textDecoration:"none"}}}),"lib::Link");function V(e){var t=e.children,i=e.body,r=e.className,o=e.style,s=e.type,l=e.disabled,u=e.linkRel,h=e.onClick,v=e.for,f=e.href,g=e.wide,p=e.ariaLabel,y=e.ariaCurrent,m=e.variant,w=void 0===m?"contained":m;t||(t=i);var b=(0,d.Z)(Y(),1)[0],k=function(e,t){if(e){var i=t[e];if(i)return i}return"default"in t?t.default:void 0}(w,{contained:b.isContained,outlined:b.isOutlined,text:b.isText,clean:b.isClean}),j={children:t,className:a(b.button,g&&b.isWide,k,r),style:o,"aria-disabled":!!l||void 0,"aria-current":y};return v?(0,n.jsx)("label",(0,x.Z)((0,c.Z)({},j),{htmlFor:v})):h||s?(0,n.jsx)("button",(0,x.Z)((0,c.Z)({},j),{disabled:l,"aria-label":p,type:s,onClick:h})):f&&!l?(0,n.jsx)(G,(0,x.Z)((0,c.Z)({},j),{rel:u,href:f})):(0,n.jsx)("div",(0,c.Z)({},j))}var q,X,J,Y=(0,_.Z)((function(e){var t=e.components;return{button:(0,x.Z)((0,c.Z)({display:"flex",justifyContent:"center",alignItems:"center",width:"max-content",height:"45px",padding:"0 35px",backgroundColor:"transparent",cursor:"pointer",textDecoration:"none",textAlign:"center",color:"inherit",font:"inherit",lineHeight:"inherit",borderWidth:0,borderColor:"transparent"},t.Button),{"&[aria-disabled]":(0,c.Z)({},t.Button_Disabled)}),isContained:(0,c.Z)({},t.Button_Contained),isOutlined:(0,c.Z)({},t.Button_Outlined),isText:(0,c.Z)({},t.Button_Text),isClean:{display:"block",padding:0,border:"unset",borderRadius:0,color:"inherit",textAlign:"inherit"},isWide:{width:"unset"}}}),"lib::Button");function Q(e,t){return e?Object.fromEntries(Object.entries(e).filter((function(e){var i=(0,d.Z)(e,2),n=i[0],r=i[1];return t(n,r)}))):{}}(0,_.Z)((function(e){var t,i,n,r,o,s,l,a,d,u,h=e.components;return{input:(0,c.Z)({position:"relative",borderRadius:null===(t=h.Input)||void 0===t?void 0:t.borderRadius,backgroundColor:null===(i=h.Input)||void 0===i?void 0:i.backgroundColor,textAlign:"left",padding:0},Q(h.Input,(function(e){return!e.includes("padding")&&(!e.includes("border")||e.includes("Radius"))}))),nativeIinputClear:{position:"relative",display:"block",width:"100%",height:"100%",lineHeight:"inherit",font:"inherit",color:"inherit",border:"none",backgroundColor:"unset",zIndex:1,"& + *":{border:"none"}},nativeIinput:(0,x.Z)((0,c.Z)({position:"relative",color:"inherit"},Q(h.Input,(function(e){return!e.includes("margin")&&!e.includes("border")}))),{borderWidth:null!==(X=null!==(q=null===(n=h.Input)||void 0===n?void 0:n.borderWidth)&&void 0!==q?q:null===(o=null===(r=h.Input)||void 0===r?void 0:r.border.match(/^\d+\w+/))||void 0===o?void 0:o[0])&&void 0!==X?X:0,borderStyle:"solid",borderColor:"transparent","& + *":{border:null===(s=h.Input)||void 0===s?void 0:s.border,borderWidth:null===(l=h.Input)||void 0===l?void 0:l.borderWidth},"&:focus-visible":(0,x.Z)((0,c.Z)({outlineWidth:null===(a=h.Input)||void 0===a?void 0:a.borderWidth,outlineOffset:"-0.4em"},null===(d=h.Input)||void 0===d?void 0:d["&:focus-visible"]),{borderColor:"transparent"}),backgroundColor:"unset",zIndex:1}),placeholderClear:{position:"absolute",inset:0,margin:0,padding:0},placeholder:(0,x.Z)((0,c.Z)({position:"absolute",inset:0,margin:0,padding:null!==(J=null===(u=h.Input)||void 0===u?void 0:u.padding)&&void 0!==J?J:0},Q(h.Input,(function(e){return!e.includes("margin")&&!e.includes("height")&&(!e.includes("border")||e.includes("Radius"))}))),{"& > legend":{position:"relative",top:"-0.8em",margin:0,height:1}}),innerPlaceholder:{"& > legend":{position:"absolute",transform:"translateY( calc( 100% - 0.2em ) )",width:"100%",height:"unset"}}}}),"lib::Input");(0,_.Z)((function(e){var t=e.components;return{select:{position:"relative",display:"flex",margin:0,padding:0,border:"none",textAlign:"left",cursor:"pointer"},value:(0,c.Z)({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},t.Select),nativeSelect:{width:1,height:1,border:"none",outline:"none"},values:(0,x.Z)((0,c.Z)({position:"absolute",left:0,top:0,margin:0,padding:0,listStyle:"none",width:"100%",zIndex:10,overflow:"hidden","&:not([aria-expanded])":{display:"none"}},t.Select_Dropdown),{"& > li > button":(0,c.Z)({width:"100%",border:"none",background:"none",font:"inherit",textAlign:"inherit",cursor:"pointer"},t.Select_Dropdown_Value)})}}));(0,_.Z)({"@keyframes closing":{from:{gridTemplateRows:"1fr"},to:{gridTemplateRows:"0fr"}},"@keyframes opening":{from:{gridTemplateRows:"0fr"},to:{gridTemplateRows:"1fr"}},body:{display:"grid","& > div":{overflow:"hidden"}},isOpening:{animation:"0.2s ease $opening",animationFillMode:"forwards"},isClosing:{animation:"0.2s ease $closing",animationFillMode:"forwards"}},"lib::Spoiler");function ee(e){var t=e.className,i=e.onStartClick,r=(0,d.Z)(h(),2),o=r[0],s=r[1],l={positive:te(s.atoms.colors.positive),negative:te(s.atoms.colors.negative),background:te(s.atoms.colors.background)},c=function(e,t,i){Number.isNaN(i)&&(i=0),console.log(s.state,i,ie(s.state["".concat(e,"Color")],t,i)),s.setState("".concat(e,"Color"),ie(s.state["".concat(e,"Color")],t,i))},u=function(e){return function(t){e(t.target.valueAsNumber)}};return(0,n.jsxs)("section",{className:a(o.gameStartScreen,t),children:[(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)("h1",{children:"Wyprawa w nieznane"}),(0,n.jsx)("p",{children:"Jako przypadkowo wybrany podr\xf3\u017cnik, nie masz poj\u0119cia jak kierowa\u0107 statkami."}),(0,n.jsx)("p",{children:"Los jednak chcia\u0142, \u017ce musisz si\u0119 tego pr\u0119dko nauczy\u0107. Z pocz\u0105tku nie b\u0119dzie \u0142atwo, lecz z czasem powiniene\u015b za\u0142apa\u0107."}),(0,n.jsx)("p",{children:"Kto wie, jakie niebezpiecze\u0144stwa na Ciebie czekaj\u0105..."}),(0,n.jsx)("br",{}),(0,n.jsx)("h1",{children:"Paleta barw"}),(0,n.jsx)("p",{children:"Mo\u017cesz ustawi\u0107 w\u0142asne 3 kolory, z kt\xf3rych sk\u0142ada\u0107 si\u0119 b\u0119dzie kolorystyka aplikacji"})]}),(0,n.jsx)("div",{className:o.colorsSetters,style:{textAlign:"center"},children:Object.keys(l).map((function(e){return(0,n.jsxs)("div",{className:o.colorSetter,children:[(0,n.jsx)("input",{type:"number",min:0,max:255,value:l[e].r,onChange:u((function(t){return c(e,"r",t)}))}),(0,n.jsx)("input",{type:"number",min:0,max:255,value:l[e].g,onChange:u((function(t){return c(e,"g",t)}))}),(0,n.jsx)("input",{type:"number",min:0,max:255,value:l[e].b,onChange:u((function(t){return c(e,"b",t)}))}),(0,n.jsx)("div",{className:a(o.frame,o.colorBox),style:{backgroundColor:s.state["".concat(e,"Color")]}})]},e)}))}),(0,n.jsx)(V,{variant:"clean",body:"Rozpocznij wypraw\u0119",onClick:i})]})}function te(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}}function ie(e,t,i){var n=i.toString(16).padStart(2,"0"),r="r"===t?1:"g"===t?3:5;return e.slice(0,r)+n+e.slice(r+2)}function ne(e){var t=e.className,i=(0,o.useState)(!1),r=i[0],s=i[1];return(0,n.jsx)("div",{className:a(t),children:r?(0,n.jsx)(U,{}):(0,n.jsx)(ee,{onStartClick:function(){return s(!0)}})})}function re(){return oe(),(0,n.jsx)(ne,{})}var oe=(0,r.Rk)((function(e){var t=e.atoms;return{"@global":{"*":{boxSizing:"border-box"},body:{margin:0,backgroundColor:t.colors.background,fontFamily:"consolas",fontSize:t.sizes.font.p},h3:{fontSize:t.sizes.font.h3}}}}))}},function(e){e.O(0,[691,774,888,179],(function(){return t=8312,e(e.s=t);var t}));var t=e.O();_N_E=t}]);