(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(6250)}])},6250:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return ae}});var n=i(5893),r=i(4326),o=i(7294),l=i(9815);function s(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t.reduce((function(e,t){return t&&"string"===typeof t?"".concat(e," ").concat(t.trim()):e}),"").trim();return n.length?n:void 0}function a(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return s.apply(void 0,(0,l.Z)(t))}var d=i(828),c=i(6042),u=i(5675),h=i.n(u),v=i(8620);function g(e){var t=e.className,i=e.id,r=e.src,o=e.alt,l=e.fill,s=e.priority,u=e.quality,v=e.width,g=e.height,p=e.inline,y=e.loading,m=e.style,x=e.align,w=(0,d.Z)(f(),1)[0];return x&&(m||(m={}),"center"===x?m.marginInline="auto":"right"===x&&(m.marginLeft="auto")),p?(0,n.jsx)("figure",{className:a(w.inlineFigure,t),style:{width:v,height:g},children:(0,n.jsx)("img",{id:i,className:w.inlineImg,loading:"lazy",src:r,alt:o})}):v||g?v&&g?(0,n.jsx)(h(),{id:i,className:a(w.img,t),loading:y,priority:s,quality:u,width:v,height:g,style:(0,c.Z)({height:g?void 0:"unset"},m),src:r,alt:o}):(0,n.jsx)("figure",{className:a(w.figure,t),style:{width:v,height:g},children:(0,n.jsx)("img",{id:i,className:w.img,loading:"lazy",src:r,alt:o})}):l?(0,n.jsx)(h(),{id:i,className:a(w.img,t),loading:y,priority:s,quality:u,src:r,alt:o}):(0,n.jsx)("img",{id:i,className:a(w.img,t),style:m,loading:"lazy",src:r,alt:o})}var f=(0,v.Z)((function(e){var t=e.components;return{figure:{display:"flex",alignItems:"center",justifyContent:"center",margin:0},img:(0,c.Z)({display:"block",maxWidth:"100%",maxHeight:"100%"},t.Image),inlineFigure:{display:"inline-block",margin:0,textAlign:"center",width:"1em",height:"1em"},inlineImg:{verticalAlign:"middle"}}}),"lib::Image"),p=function(e,t){return{"&::before":(0,c.Z)({content:'""',display:"block",position:"absolute",inset:0,borderWidth:0,borderStyle:"solid",borderColor:e.colors.positive+"aa"},t),"&::after":(0,c.Z)({content:'""',display:"block",position:"absolute",inset:0,borderWidth:0,borderStyle:"solid",borderColor:e.colors.negative+"aa"},t)}},y=(0,r.Rk)((function(e){var t=e.atoms;return{"@keyframes shift-before":{"0%":{transform:"translate( 0, 0 )"},"5%":{transform:"translate( 2px, 2px )"},"10%":{transform:"translate( 0, 0 )"},"100%":{transform:"translate( 0, 0 )"}},"@keyframes shift-after":{"0%":{transform:"translate( 0, 0 )"},"5%":{transform:"translate( -2px, -2px )"},"10%":{transform:"translate( 0, 0 )"},"100%":{transform:"translate( 0, 0 )"}},gameStartScreen:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:t.colors.positive,height:"100dvh"},colorsSetters:{margin:"0 auto",width:"max-content"},colorSetter:{display:"flex",gap:t.spacing.main,marginBlock:t.spacing.main},colorBox:{width:50,height:25,"body &::before":{inset:-5,animation:"10s infinite ease-in-out",animationDelay:"2s",animationName:"$shift-before"},"body &::after":{inset:-5,animation:"10s infinite ease-in-out",animationDelay:"2s",animationName:"$shift-after"}},gameUi:{display:"grid",gridTemplateColumns:"200px 1fr 200px",width:"100%",height:"100dvh"},column:{padding:t.spacing.small,"&.is-positive":{color:t.colors.positive},"&.is-negative":{color:t.colors.positive}},canvasesWrapper:(0,c.Z)({position:"relative"},p(t,{borderLeftWidth:t.sizes.border.width,borderRightWidth:t.sizes.border.width})),canvas:{position:"absolute",left:t.sizes.border.width,top:0,width:"calc( 100% - ".concat(2*t.sizes.border.width,"px )"),height:"100%"},avatar:{width:"100%",aspectRatio:1},frame:(0,c.Z)({position:"relative"},p(t,{borderWidth:t.sizes.border.width})),stats:{padding:0,"dl&":{display:"grid",gridTemplateColumns:"1fr 1fr",alignItems:"center",gap:t.spacing.main},"& > dt":{textAlign:"right"},"& > dd":{textAlign:"left",margin:0},"& > li":{textAlign:"left",listStyle:"none",margin:t.spacing.main}}}})),m=i(1438),x=i(8029),w=i(6567),b=i(849),Z=i(5427),j=i(9396),k=function(e){return"x"in e&&"y"in e},T=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this;(0,m.Z)(this,e),this.tags=new Set,this.color=t,i.forEach((function(e){return n.tags.add(e)}))},C=function(){function e(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];(0,m.Z)(this,e),this.tags=new Set,this.items=[],this.items=i}var t=e.prototype;return t.push=function(e){this.items.push(e)},t.clear=function(){this.items=[]},t.clone=function(e){this.items=(0,l.Z)(e.items)},t.getTop=function(){var e;return null!==(e=this.items[this.items.length-1])&&void 0!==e?e:null},e}(),D=new WeakSet,P=function(){function e(t){(0,m.Z)(this,e),(0,Z.Z)(this,D),this.levelDimensions={x:200,y:600},this.levelData=[],this.cellSize=5,this.lastPlayerPos={x:-1,y:-1},this.entities=[],this.drawOffset={x:0,y:0},this.colors=t,this.processLevelData(S)}var t=e.prototype;return t.processLevelData=function(e){var t=this;this.levelData=Array.from({length:this.levelDimensions.y},(function(){return[]})),e.forEach((function(e){var i=function(){return new T(t.getColor(e.color),e.tags)};!function(e){return k(e)&&"w"in e&&"h"in e}(e)?!function(e){return k(e)&&"w"in e}(e)?!function(e){return k(e)&&"h"in e}(e)?k(e)&&(t.setCellItem(e.x,e.y,i()),function(e){return k(e)&&e.tags.includes("player")}(e)&&(t.lastPlayerPos.x=e.x,t.lastPlayerPos.y=e.y)):t.setVerticalLine(e.x,e.y,e.h,i):t.setHorizontalLine(e.x,e.y,e.w,i):t.setRect(e.x,e.y,e.w,e.h,i)}))},t.draw=function(e){var t=this,i=this,n=i.levelData,r=i.levelDimensions,o=i.drawOffset,l=this.getCtxDimensions(e),s=l.width,a=l.height,d=l.center,c=s/r.x,u=Math.floor(a/c);e.clearRect(0,0,s,a),e.save(),e.translate(d.x-(r.x+o.x)*c/2,a-(r.y-o.y)*c);var h=r.y-o.y-u;n.slice(h,r.y-o.y).forEach((function(i,n){return i.forEach((function(i,r){return i.items.forEach((function(i){if(i){var o=h+n;if(i.tags.has("border")){var l=c/4;e.fillStyle="".concat(t.colors.safe,"aa"),e.fillRect(r*c-l,o*c-l,c,c),e.fillStyle="".concat(t.colors.danger,"aa"),e.fillRect(r*c+l,o*c+l,c,c)}else e.fillStyle=i.color,e.fillRect(r*c,o*c,c,c)}}))}))})),e.restore()},t.logic=function(e){var t=this.getCtxDimensions(e),i=t.width,n=t.height,r=t.center,o=this.getPlayerTileInfo(),l=this.levelDimensions,s=this.drawOffset,a=i/l.x,d=o.y-s.y-r.y/a,c=Math.floor(n/a),u=s.y,h=l.y-c-s.y;u>0&&d<-25&&this.drawOffset.y--,h>0&&d>25&&this.drawOffset.y++},t.createTile=function(e,t,i){"danger"===i&&this.entities.push({x:e,y:t,tags:[i]}),this.setCellItem(e,t,new T(this.getColor(i),[i]))},t.getPlayerTileInfo=function(){var e,t,i=(0,j.Z)((0,c.Z)({},this.lastPlayerPos),{tile:null===(e=this.getCell(this.lastPlayerPos.x,this.lastPlayerPos.y))||void 0===e?void 0:e.getTop()});if(!(null===(t=i.tile)||void 0===t?void 0:t.tags.has("player"))){console.log("player losted");for(var n=0;n<this.levelData.length;++n)for(var r=0;r<this.levelData[n].length;++r){var o,l=null===(o=this.levelData[n][r])||void 0===o?void 0:o.getTop();if(null===l||void 0===l?void 0:l.tags.has("player")){this.lastPlayerPos.x=r,this.lastPlayerPos.y=n,i.x=r,i.y=n,i.tile=l;break}}}return i},t.removeEntity=function(e,t){var i,n=this.entities.findIndex((function(i){return i.x===e&&i.y===t}));-1!==n&&(this.entities.splice(n,1),null===(i=this.getCell(e,t))||void 0===i||i.clear())},t.moveEnemyBy=function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=r.withTeleportation,l=void 0!==o&&o,s=r.swapeableTags,a=void 0===s?["trail"]:s,d=this.entities.find((function(i){return i.x===e&&i.y===t}));if(d){var u=this.moveTileBy(d.x,d.y,i,n,{withTeleportation:l,swapeableTags:a});return u?(d.x+=i,d.y+=n,d.x<0?d.x=this.levelDimensions.x+d.x:d.x%=this.levelDimensions.x,d.y<0?d.y=this.levelDimensions.y+d.y:d.y%=this.levelDimensions.y,(0,j.Z)((0,c.Z)({},d),{swapedCell:u})):{collidingCell:this.getCell(d.x+i,d.y+n)}}},t.movePlayerBy=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.withTeleportation,r=void 0!==n&&n,o=i.swapeableTags,l=void 0===o?["trail","land","deep land"]:o,s=this.getPlayerTileInfo(),a=s.tile;if(a){var d=this.moveTileBy(this.lastPlayerPos.x,this.lastPlayerPos.y,e,t,{withTeleportation:r,swapeableTags:l});return d?(this.lastPlayerPos.x+=e,this.lastPlayerPos.y+=t,this.lastPlayerPos.x<0?this.lastPlayerPos.x=this.levelDimensions.x+this.lastPlayerPos.x:this.lastPlayerPos.x%=this.levelDimensions.x,this.lastPlayerPos.y<0?this.lastPlayerPos.y=this.levelDimensions.y+this.lastPlayerPos.y:this.lastPlayerPos.y%=this.levelDimensions.y,(0,j.Z)((0,c.Z)({},this.lastPlayerPos),{swapedCell:d})):{collidingCell:this.getCell(this.lastPlayerPos.x+e,this.lastPlayerPos.y+t)}}},t.moveTileBy=function(e,t,i,n){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=o.withTeleportation,s=void 0!==l&&l,a=o.swapeableTags,d=void 0===a?[]:a,c=this.getCell(e,t,s);if(!c)return!1;var u=this.getCell(e+i,t+n,s);if(!u)return!1;var h=null===(r=u.getTop())||void 0===r?void 0:r.tags;if(h&&d.length&&!d.some((function(e){return null===h||void 0===h?void 0:h.has(e)})))return!1;var v=new C;return v.clone(u),u.clone(c),c.clear(),v},t.getColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"land";return"land"===e?this.colors.safe:"player"===e?"".concat(this.colors.safe):"deep land"===e?"".concat(this.colors.safe,"aa"):"trail"===e?"".concat(this.colors.safe,"77"):"danger"===e?"".concat(this.colors.danger,"aa"):e},t.getCtxDimensions=function(e){return{width:e.canvas.width,height:e.canvas.height,center:{x:e.canvas.width/2,y:e.canvas.height/2}}},t.getCellNeighbours=function(e,t){var i,n,r,o,l,s,a,d,c,u,h,v,g,f,p,y,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=this.getRow(t),w=this.getRow(t+1),b=this.getRow(t-1),Z={north:null!==(l=null===w||void 0===w||null===(i=w[e])||void 0===i?void 0:i.getTop())&&void 0!==l?l:null,east:null!==(s=null===x||void 0===x||null===(n=x[e+1])||void 0===n?void 0:n.getTop())&&void 0!==s?s:null,south:null!==(a=null===b||void 0===b||null===(r=b[e])||void 0===r?void 0:r.getTop())&&void 0!==a?a:null,west:null!==(d=null===x||void 0===x||null===(o=x[e-1])||void 0===o?void 0:o.getTop())&&void 0!==d?d:null};m&&(Z.northEast=null!==(g=null===w||void 0===w||null===(c=w[e+1])||void 0===c?void 0:c.getTop())&&void 0!==g?g:null,Z.southEast=null!==(f=null===b||void 0===b||null===(u=b[e+1])||void 0===u?void 0:u.getTop())&&void 0!==f?f:null,Z.southWest=null!==(p=null===b||void 0===b||null===(h=b[e-1])||void 0===h?void 0:h.getTop())&&void 0!==p?p:null,Z.northWest=null!==(y=null===w||void 0===w||null===(v=w[e-1])||void 0===v?void 0:v.getTop())&&void 0!==y?y:null);return Z},t.fillArea=function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1e3,l=this,s=[],a=(0,b.Z)(this,D,A).call(this,e,t,i,n,r,o,s);return a?(s.forEach((function(t){var i,n=t.x,r=t.y,o=t.createTile,s=l.getCell(n,r);s&&(s.tags.delete(e),(null===(i=s.getTop())||void 0===i?void 0:i.tags.has("danger"))&&l.removeEntity(n,r),s.clear(),o&&s.push(o(n,r)))})),s.length):(s.forEach((function(t){var i,n=t.x,r=t.y;return null===(i=l.getCell(n,r))||void 0===i?void 0:i.tags.delete(e)})),!1)},t.fillAreaWithLand=function(e,t){var i=this,n=Date.now(),r={terminatorTags:[["border",null]],acceptTags:[["danger",function(){return new T(i.getColor("deep land"),["deep land"])}]]};return this.fillArea("".concat(n),e,t,(function(){return new T(i.getColor("deep land"),["deep land"])}),r,2e3)},t.destroyFilledLand=function(e,t){var i=Date.now();return this.fillArea("".concat(i),e,t,void 0,{acceptTags:[["deep land",null]]},2e3)},t.removeTagged=function(e){for(var t=0;t<this.levelData.length;++t)for(var i=0;i<this.levelData[t].length;++i){var n,r=this.levelData[t][i];(null===(n=null===r||void 0===r?void 0:r.getTop())||void 0===n?void 0:n.tags.has(e))&&r.clear()}},t.getRow=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&(e<0||e>=this.levelDimensions.y))return null;var i,n=e%this.levelDimensions.y,r=n<0?-n-1:this.levelData.length-1-n;return null!==(i=this.levelData[r])&&void 0!==i?i:[]},t.getCell=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!i&&(e<0||e>=this.levelDimensions.x))return null;var n=this.getRow(t,i);if(!n)return null;var r=e%this.levelDimensions.x,o=r<0?this.levelDimensions.x+r:r;return n[o]||(n[o]=new C),n[o]},t.setCell=function(e,t){var i=this.getRow(t);i&&(i[e<0?i.length-e:e]=new C)},t.setCellItem=function(e,t,i){var n=this.getRow(t);if(n){var r=e<0?n.length-e:e;n[r]||(n[r]=new C),n[r].push(i)}},t.setHorizontalLine=function(e,t,i,n){var r=t<0?-t-1:this.levelData.length-t,o=this.levelData[r];if(o)for(var l=i<0?this.levelDimensions.x-i:i,s=e<0?o.length-e:e,a=0;a<l;++a)o[s+a]||(o[s+a]=new C),o[s+a].push(n(e,t))},t.setVerticalLine=function(e,t,i,n){for(var r=e<0?this.levelDimensions.x-e:e,o=0;o<i;++o){var l=this.getRow(t+o);l&&(l[r]||(l[r]=new C),l[r].push(n(e,t)))}},t.setRect=function(e,t,i,n,r){for(var o=e<0?this.levelDimensions.x-e:e,l=i<0?this.levelDimensions.x-i:i,s=0;s<n;++s){var a=this.getRow(t+s);if(a)for(var d=0;d<l;++d)a[o+d]||(a[o+d]=new C),a[o+d].push(r(e,t))}},e}();function A(e,t,i,n){var r,o,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=l.acceptTags,a=l.terminatorTags,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],h=this,v=null===(r=this.getCell(t,i))||void 0===r?void 0:r.getTop(),g=this.getRow(i),f="filling-".concat(e);if(!g||(null===(o=g[t])||void 0===o?void 0:o.tags.has(f)))return!0;if(u.length>c)return!1;if(i>this.levelData.length||i<0)return!1;if(v){if((null===a||void 0===a?void 0:a.length)&&a.some((function(e){var t=(0,d.Z)(e,1)[0];return v.tags.has(t)})))return!1;if((null===s||void 0===s?void 0:s.length)&&!s.some((function(e){var t=(0,d.Z)(e,1)[0];return v.tags.has(t)})))return!0}for(var p=function(t,i){var r=h.getCell(t,i);if(!r)return!1;if(r.tags.has(f))return!1;if(r.getTop()){var o,l,v=null===(o=r.getTop())||void 0===o?void 0:o.tags,g=null===(l=null===s||void 0===s?void 0:s.find((function(e){var t=(0,d.Z)(e,1)[0];return null===v||void 0===v?void 0:v.has(t)})))||void 0===l?void 0:l[1];if(void 0===g)return!1;u.push({x:t,y:i,createTile:g})}else u.push({x:t,y:i,createTile:n});r.tags.add(f);var p=(0,b.Z)(h,D,A).call(h,e,t,i+1,n,{acceptTags:s,terminatorTags:a},c,u);return p&&(p=(0,b.Z)(h,D,A).call(h,e,t,i-1,n,{acceptTags:s,terminatorTags:a},c,u))||null},y=t;y<this.levelDimensions.x;++y){if(u.length>c)return!1;var m=p(y,i);if(null===m)return!1;if(!m)break}for(var x=t-1;x>0;--x){if(u.length>c)return!1;var w=p(x,i);if(null===w)return!1;if(!w)break}return u.length<=c}var S=[{tags:["deep land"],x:0,y:-1,w:-1,h:1},{tags:["border","border-2"],x:0,y:450,w:-1,h:2},{tags:["border","border-1"],x:0,y:150,w:-1,h:2},{tags:["player"],color:"player",x:90,y:10},{tags:["city"],color:"land",x:0,y:0,w:-1,h:10}],I=i(5315),z=i(2221),N=i(8409),W=new WeakMap,R=new WeakMap,L=new WeakMap,E=new WeakSet,F=new WeakMap,B=function(){function e(t){var i=this;(0,m.Z)(this,e),(0,Z.Z)(this,E),(0,z.Z)(this,W,{writable:!0,value:-1}),(0,z.Z)(this,R,{writable:!0,value:null}),(0,z.Z)(this,L,{writable:!0,value:!1}),this.ctxs=new Map,(0,z.Z)(this,F,{writable:!0,value:function(){i.ctxs.forEach((function(e){return(0,b.Z)(i,E,M).call(i,e.canvas)}))}}),this.root=t}var t=e.prototype;return t.enable=function(){window.addEventListener("resize",(0,I.Z)(this,F)),(0,I.Z)(this,F).call(this),this.startLoop()},t.disable=function(){window.removeEventListener("resize",(0,I.Z)(this,F)),this.stopLoop()},t.startLoop=function(){var e=this,t=function(){return requestAnimationFrame((function(){(0,I.Z)(e,L)||(e.logic(),e.draw(),(0,N.Z)(e,W,window.setTimeout(t,1e3/60)))}))};(0,N.Z)(this,L,!1),t()},t.stopLoop=function(){(0,N.Z)(this,L,!0),window.clearTimeout((0,I.Z)(this,W))},t.setUIUpdater=function(e){(0,N.Z)(this,R,e)},t.updateUi=function(){(0,I.Z)(this,R)&&(0,I.Z)(this,R).call(this,structuredClone(this.uiData))},t.registerCtx=function(e,t){var i="string"!==typeof t?t:this.root.querySelector(t),n=null===i||void 0===i?void 0:i.getContext("2d");if("string"===typeof t&&!i)throw new Error('Canvas "'.concat(e,'" not found with provided selector: "').concat(t,'"'));if(!n)throw new Error('Cannot create 2D context for "'.concat(e,'" canvas'));return this.ctxs.set(e,n),(0,b.Z)(this,E,M).call(this,n.canvas),n},e}();function M(e){e.width=e.clientWidth,e.height=e.clientHeight}var O=new WeakMap,U=new WeakMap,_=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,m.Z)(this,e),(0,z.Z)(this,O,{writable:!0,value:void 0}),(0,z.Z)(this,U,{writable:!0,value:void 0}),this.code=t,(0,N.Z)(this,O,i),(0,N.Z)(this,U,n)}var t=e.prototype;return t.setPressed=function(e){(0,I.Z)(this,O)!==e&&((0,N.Z)(this,U,!1),(0,N.Z)(this,O,e))},t.getPressed=function(){return(0,I.Z)(this,O)},t.getOnce=function(){return!(!(0,I.Z)(this,O)||(0,I.Z)(this,U))&&((0,N.Z)(this,U,!0),!0)},e}(),K=function(){function e(){(0,m.Z)(this,e)}var t=e.prototype;return t.isPressed=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=!0,o=!1,l=void 0;try{for(var s,a=i[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var d=s.value,c=e.keysMap.get(d.toLowerCase());if(null===c||void 0===c?void 0:c.getPressed())return!0}}catch(u){o=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return!1},t.isPressedOnce=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=!0,o=!1,l=void 0;try{for(var s,a=i[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var d=s.value,c=e.keysMap.get(d.toLowerCase());if(null===c||void 0===c?void 0:c.getOnce())return!0}}catch(u){o=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return!1},e}();K.keysMap=new Map;!function(){var e=window;e&&(e.addEventListener("keydown",(function(e){var t=e.code,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")&&(i=t.slice(5)),i=i.toLowerCase();var n=K.keysMap.get(i);n?n.setPressed(!0):K.keysMap.set(i,new _(i,!0))})),e.addEventListener("keyup",(function(e){var t=e.code,i=t;t.startsWith("Key")?i=t.slice(3):t.startsWith("Arrow")&&(i=t.slice(5)),i=i.toLowerCase();var n=K.keysMap.get(i);n?n.setPressed(!1):K.keysMap.set(i,new _(i,!1))})))}();var H=function(e){(0,x.Z)(i,e);var t=(0,w.Z)(i);function i(e,n){var r,o=n.colors;return(0,m.Z)(this,i),(r=t.call(this,e)).debug=!1,r.keys=new K,r.ticks=0,r.level=null,r.uiData={experience:0,speed:r.debug?9:1,knownAreas:0,knownTiles:0,closedAreas:0,stage:0,destroyedAreas:0,score:0,visibleScore:!1,gameOver:!1,expincomeGood:!1,tooBigAreaInfo:!1,borderReached:!1,usedW:!1,usedS:!1,usedA:!1,usedD:!1},r.enemyTimerId=null,r.colors=o,r.ctx=r.registerCtx("main","canvas"),r.runLevel(1),r.startLoop(),r}var n=i.prototype;return n.runLevel=function(e){1===e&&(this.level=new P(this.colors))},n.draw=function(){var e;null===(e=this.level)||void 0===e||e.draw(this.ctx)},n.logic=function(){var e=this,t=this,i=t.level,n=t.ticks,r=t.uiData;this.ticks++;var o=9-r.speed<0?0:9-r.speed,l=r.stage<9?9-r.stage:1;if(o&&n%o!==0||this.logicBySpeed(),i)if(i.logic(this.ctx),n%l===0&&i.entities.filter((function(e){return e.tags.includes("danger")})).forEach((function(t){var n=i.moveEnemyBy(t.x,t.y,0,-1);if(n&&"collidingCell"in n){var o,l,s=null===(l=null===(o=n.collidingCell)||void 0===o?void 0:o.getTop())||void 0===l?void 0:l.tags;if(null===s||void 0===s?void 0:s.has("deep land")){var a=i.destroyFilledLand(t.x,t.y-1);a&&(i.removeEntity(t.x,t.y),r.knownTiles-=a,r.destroyedAreas++,r.knownTiles<0&&(r.knownTiles=0),e.updateUi())}else(null===s||void 0===s?void 0:s.has("city"))&&(r.gameOver=!0,e.calcScore(),e.updateUi(),e.stopLoop())}})),2===r.stage){if(!this.enemyTimerId){this.enemyTimerId=window.setTimeout((function(){!function(){var e,t=function(e,t){return Math.floor(Math.random()*(t-e))+e},n=t(3,i.levelDimensions.x-3),r=t(100,400),o=i.getCell(n,r),l=null===(e=null===o||void 0===o?void 0:o.getTop())||void 0===e?void 0:e.tags;(null===l||void 0===l?void 0:l.has("deep land"))||i.createTile(n,r,"danger")}(),e.enemyTimerId=null}),7500)}}else if(3===r.stage&&!this.enemyTimerId&&!i.entities.length){this.enemyTimerId=window.setTimeout((function(){!function(){var t,n=function(e,t){return Math.floor(Math.random()*(t-e))+e},o=n(3,i.levelDimensions.x-3),l=n(150,600),s=i.getCell(o,l),a=null===(t=null===s||void 0===s?void 0:s.getTop())||void 0===t?void 0:t.tags;if(null===a||void 0===a?void 0:a.has("deep land")){var d=i.destroyFilledLand(o,l);d&&(r.knownTiles-=d,r.destroyedAreas++,r.knownTiles<0&&(r.knownTiles=0),e.updateUi())}else i.createTile(o,l,"danger")}(),e.enemyTimerId=null}),3e3)}},n.logicBySpeed=function(){var e=this,t=e.keys,i=e.level,n=e.uiData;if(i){var r=i.getPlayerTileInfo(),o=void 0;if(t.isPressed("w","up")&&(this.updateUiFlag("usedW"),o=i.movePlayerBy(0,1)),!o&&t.isPressed("s","down")&&(this.updateUiFlag("usedS"),o=i.movePlayerBy(0,-1)),!o&&t.isPressed("a","left")&&(this.updateUiFlag("usedA"),o=i.movePlayerBy(-1,0)),!o&&t.isPressed("d","right")&&(this.updateUiFlag("usedD"),o=i.movePlayerBy(1,0)),o&&"collidingCell"in o){var l,s,a=null===(s=null===(l=o.collidingCell)||void 0===l?void 0:l.getTop())||void 0===s?void 0:s.tags;(null===a||void 0===a?void 0:a.has("border"))&&(n.borderReached=!0),this.updateUi()}else if(o&&"swapedCell"in o){var d,c=null===(d=o.swapedCell)||void 0===d?void 0:d.getTop(),u=c&&c.tags.has("trail")||(null===c||void 0===c?void 0:c.tags.has("land"))||(null===c||void 0===c?void 0:c.tags.has("deep land"));u||(n.knownTiles++,this.updateUi()),i.createTile(r.x,r.y,"trail");var h=i.getCellNeighbours(o.x,o.y);if(!u&&Object.values(h).filter(Boolean).length>1){var v=!0,g=!1,f=void 0;try{for(var p,y=[{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:-1,y:0},{x:1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1}][Symbol.iterator]();!(v=(p=y.next()).done);v=!0){var m,x=p.value,w=x.x,b=x.y,Z=i.getRow(o.y+b),j=0,k=1/0;if(Z&&!(null===(m=Z[o.x+w])||void 0===m?void 0:m.getTop())){for(var T=o.x+w;T<i.levelDimensions.x;++T){var C,D,P=null===(D=null===(C=i.getCell(T,o.y+b))||void 0===C?void 0:C.getTop())||void 0===D?void 0:D.tags;((null===P||void 0===P?void 0:P.has("trail"))||(null===P||void 0===P?void 0:P.has("player")))&&(k!=T-1&&j++,k=T)}if(0!==j){for(var A=0;A<o.x+w;++A){var S,I,z=null===(I=null===(S=i.getCell(A,o.y+b))||void 0===S?void 0:S.getTop())||void 0===I?void 0:I.tags;((null===z||void 0===z?void 0:z.has("trail"))||(null===z||void 0===z?void 0:z.has("player")))&&(k!=A-1&&j++,k=A)}if(j>0){var N=i.fillAreaWithLand(o.x+w,o.y+b);if(N){var W=n.experience;n.knownAreas+=N,n.closedAreas++;for(var R=600;R<N;R+=600)n.expincomeGood=!0,n.experience++;1===n.closedAreas?(n.speed++,n.experience++):5===n.closedAreas?n.experience++:10===n.closedAreas?(n.speed++,n.experience++):20===n.closedAreas?n.experience++:40===n.closedAreas&&(n.speed++,n.experience++),n.experience-W>2&&(n.speed+=Math.floor((n.experience-W)/3)),this.debug?(W<2&&n.experience>=2&&(i.removeTagged("border-1"),n.stage=2,n.speed++),W<2&&n.experience>=2&&(i.removeTagged("border-1"),n.stage=2,n.speed++)):(n.stage<2&&W<=7&&n.experience>=7&&(i.removeTagged("border-1"),n.experience++,n.stage=2,n.speed++),2==n.stage&&n.knownAreas>14e3&&(n.visibleScore=!0,i.removeTagged("border-2"),n.experience++,n.stage=3,n.speed++));break}n.tooBigAreaInfo=!0,this.calcScore(),this.updateUi()}}}}}catch(L){g=!0,f=L}finally{try{v||null==y.return||y.return()}finally{if(g)throw f}}}}}},n.calcScore=function(){var e=this.uiData;e.score=Math.floor((20*e.closedAreas+1*e.knownAreas+10*e.knownTiles+100*e.experience)*(1+.05*e.stage))},n.updateUiFlag=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.uiData[e]!==t&&(this.uiData[e]=t,this.updateUi())},i}(B),q=(0,o.memo)((0,o.forwardRef)((function(e,t){var i=(0,d.Z)(y(),1)[0];return(0,n.jsx)("section",{ref:t,className:i.canvasesWrapper,children:(0,n.jsx)("canvas",{className:i.canvas})})})));function G(){var e=(0,d.Z)(y(),2),t=e[0],i=e[1].atoms,r=(0,d.Z)(function(e){var t=(0,o.useRef)(null),i=(0,o.useReducer)((function(e,t){return t}),{}),n=i[0],r=i[1];(0,o.useEffect)((function(){t.current}),[]);var l=(0,o.useCallback)((function(i){var n,o;i?(t.current=e(i),null===(n=t.current)||void 0===n||n.setUIUpdater((function(e){r(e)}))):(null===(o=t.current)||void 0===o||o.disable(),t.current=null)}),[]);return[l,n,t.current]}((function(e){return new H(e,{colors:{safe:i.colors.positive,danger:i.colors.negative}})})),2),l=r[0],s=r[1],c=s.knownAreas||s.knownTiles||s.closedAreas,u=s.usedW||s.usedS||s.usedA||s.usedD,h=s.usedW&&s.usedS&&s.usedA&&s.usedD;return(0,n.jsxs)("article",{className:t.gameUi,children:[(0,n.jsxs)("section",{className:a(t.column,"is-positive"),children:[(0,n.jsx)(g,{className:a(t.avatar,t.frame),src:"#",alt:"Player's avatar"}),(0,n.jsx)("div",{style:{minHeight:250},children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:"Statystyki"}),(0,n.jsxs)("dl",{className:t.stats,children:[!!s.closedAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zamkni\u0119tych obszar\xf3w"}),(0,n.jsx)("dd",{children:s.closedAreas})]}),!!s.knownAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zbadanych teren\xf3w"}),(0,n.jsx)("dd",{children:s.knownAreas})]}),!!s.knownTiles&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Zwiedzonych p\xf3l"}),(0,n.jsx)("dd",{children:s.knownTiles})]}),!!s.experience&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Do\u015bwiadczenie"}),(0,n.jsx)("dd",{children:s.experience})]}),!!s.speed&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Pr\u0119dko\u015b\u0107 podr\xf3\u017cy"}),(0,n.jsx)("dd",{children:s.speed})]}),!!s.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Etap gry"}),(0,n.jsx)("dd",{children:s.stage})]}),!!s.destroyedAreas&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Straconych obszar\xf3w"}),(0,n.jsx)("dd",{children:s.destroyedAreas})]}),!!s.visibleScore&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Punkty"}),(0,n.jsx)("dd",{children:s.score})]})]})]}):(0,n.jsx)("h3",{children:"Statystyki?"})}),(0,n.jsx)("div",{style:{minHeight:200},children:u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:"Informacje"}),(0,n.jsx)("dl",{className:t.stats,children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{children:"Poruszanie"}),(0,n.jsxs)("dd",{children:["W, S, A, D,",(0,n.jsx)("br",{})," \u2191, \u2193, \u2190, \u2192"]})]}):[s.usedW&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"W, \u2191"]}),(0,n.jsx)("dd",{children:"Kierunek p\xf3\u0142nocy"})]},"KeyW"),s.usedS&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"S, \u2193"]}),(0,n.jsx)("dd",{children:"Kierunek po\u0142udniowy"})]},"KeyS"),s.usedA&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"A, \u2190"]}),(0,n.jsx)("dd",{children:"Kierunek zachodni"})]},"KeyA"),s.usedD&&(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)("dt",{children:["Klawisze",(0,n.jsx)("br",{}),"D, \u2192"]}),(0,n.jsx)("dd",{children:"Kierunek wschodni"})]},"KeyD")]}),(0,n.jsxs)("ol",{className:t.stats,children:[s.tooBigAreaInfo&&(0,n.jsx)("li",{children:"Zdaje si\u0119, \u017ce zbyt wielkie obszary nie mog\u0105 zosta\u0107 zbadane."}),s.tooBigAreaInfo&&s.expincomeGood&&(0,n.jsx)("li",{children:"Natomiast w pewnych granicach rozs\u0105dku co do rozmiaru badanego obszaru, mog\u0119 si\u0119 sporo nauczy\u0107."}),s.borderReached&&(0,n.jsx)("li",{children:"Dalej nie chc\u0119 wyp\u0142ywa\u0107 bez zdobycia wi\u0119kszje liczby do\u015bwiadczenia"}),s.gameOver&&(0,n.jsxs)("li",{children:["Gra zako\u0144czona. Zebrano ",s.score," punkt\xf3w"]})]})]}):(0,n.jsx)("h3",{children:"Informacje?"})})]}),(0,n.jsx)(q,{ref:l}),(0,n.jsx)("section",{className:a(t.column,"is-negative"),children:(0,n.jsx)(g,{className:a(t.avatar,t.frame),src:"#",alt:"Opponent avatar"})})]})}var $=i(1664),V=i.n($);function X(e){var t=e.children,i=e.body,r=e.variant,o=e.ariaLabel,l=e.ariaCurrent,s=e.rel,u=e.className,h=e.href;t||(t=i);var v=(0,d.Z)(Y(),1)[0],g={className:a("clean"===r?v.clearLink:v.link,u),"aria-label":o,"aria-current":l||void 0,children:t};return h?/https?:\/\//.test(h)?(0,n.jsx)("a",(0,j.Z)((0,c.Z)({},g),{rel:s,href:h})):(0,n.jsx)(V(),(0,j.Z)((0,c.Z)({},g),{rel:s,href:h})):(0,n.jsx)("span",(0,c.Z)({},g))}var Y=(0,v.Z)((function(e){var t=e.components;return{link:(0,c.Z)({color:"inherit",textDecoration:"none"},t.Link),clearLink:{color:"inherit",textDecoration:"none"}}}),"lib::Link");function J(e){var t=e.children,i=e.body,r=e.className,o=e.style,l=e.type,s=e.disabled,u=e.linkRel,h=e.onClick,v=e.for,g=e.href,f=e.wide,p=e.ariaLabel,y=e.ariaCurrent,m=e.variant,x=void 0===m?"contained":m;t||(t=i);var w=(0,d.Z)(ie(),1)[0],b=function(e,t){if(e){var i=t[e];if(i)return i}return"default"in t?t.default:void 0}(x,{contained:w.isContained,outlined:w.isOutlined,text:w.isText,clean:w.isClean}),Z={children:t,className:a(w.button,f&&w.isWide,b,r),style:o,"aria-disabled":!!s||void 0,"aria-current":y};return v?(0,n.jsx)("label",(0,j.Z)((0,c.Z)({},Z),{htmlFor:v})):h||l?(0,n.jsx)("button",(0,j.Z)((0,c.Z)({},Z),{disabled:s,"aria-label":p,type:l,onClick:h})):g&&!s?(0,n.jsx)(X,(0,j.Z)((0,c.Z)({},Z),{rel:u,href:g})):(0,n.jsx)("div",(0,c.Z)({},Z))}var Q,ee,te,ie=(0,v.Z)((function(e){var t=e.components;return{button:(0,j.Z)((0,c.Z)({display:"flex",justifyContent:"center",alignItems:"center",width:"max-content",height:"45px",padding:"0 35px",backgroundColor:"transparent",cursor:"pointer",textDecoration:"none",textAlign:"center",color:"inherit",font:"inherit",lineHeight:"inherit",borderWidth:0,borderColor:"transparent"},t.Button),{"&[aria-disabled]":(0,c.Z)({},t.Button_Disabled)}),isContained:(0,c.Z)({},t.Button_Contained),isOutlined:(0,c.Z)({},t.Button_Outlined),isText:(0,c.Z)({},t.Button_Text),isClean:{display:"block",padding:0,border:"unset",borderRadius:0,color:"inherit",textAlign:"inherit"},isWide:{width:"unset"}}}),"lib::Button");function ne(e,t){return e?Object.fromEntries(Object.entries(e).filter((function(e){var i=(0,d.Z)(e,2),n=i[0],r=i[1];return t(n,r)}))):{}}(0,v.Z)((function(e){var t,i,n,r,o,l,s,a,d,u,h=e.components;return{input:(0,c.Z)({position:"relative",borderRadius:null===(t=h.Input)||void 0===t?void 0:t.borderRadius,backgroundColor:null===(i=h.Input)||void 0===i?void 0:i.backgroundColor,textAlign:"left",padding:0},ne(h.Input,(function(e){return!e.includes("padding")&&(!e.includes("border")||e.includes("Radius"))}))),nativeIinputClear:{position:"relative",display:"block",width:"100%",height:"100%",lineHeight:"inherit",font:"inherit",color:"inherit",border:"none",backgroundColor:"unset",zIndex:1,"& + *":{border:"none"}},nativeIinput:(0,j.Z)((0,c.Z)({position:"relative",color:"inherit"},ne(h.Input,(function(e){return!e.includes("margin")&&!e.includes("border")}))),{borderWidth:null!==(ee=null!==(Q=null===(n=h.Input)||void 0===n?void 0:n.borderWidth)&&void 0!==Q?Q:null===(o=null===(r=h.Input)||void 0===r?void 0:r.border.match(/^\d+\w+/))||void 0===o?void 0:o[0])&&void 0!==ee?ee:0,borderStyle:"solid",borderColor:"transparent","& + *":{border:null===(l=h.Input)||void 0===l?void 0:l.border,borderWidth:null===(s=h.Input)||void 0===s?void 0:s.borderWidth},"&:focus-visible":(0,j.Z)((0,c.Z)({outlineWidth:null===(a=h.Input)||void 0===a?void 0:a.borderWidth,outlineOffset:"-0.4em"},null===(d=h.Input)||void 0===d?void 0:d["&:focus-visible"]),{borderColor:"transparent"}),backgroundColor:"unset",zIndex:1}),placeholderClear:{position:"absolute",inset:0,margin:0,padding:0},placeholder:(0,j.Z)((0,c.Z)({position:"absolute",inset:0,margin:0,padding:null!==(te=null===(u=h.Input)||void 0===u?void 0:u.padding)&&void 0!==te?te:0},ne(h.Input,(function(e){return!e.includes("margin")&&!e.includes("height")&&(!e.includes("border")||e.includes("Radius"))}))),{"& > legend":{position:"relative",top:"-0.8em",margin:0,height:1}}),innerPlaceholder:{"& > legend":{position:"absolute",transform:"translateY( calc( 100% - 0.2em ) )",width:"100%",height:"unset"}}}}),"lib::Input");(0,v.Z)((function(e){var t=e.components;return{select:{position:"relative",display:"flex",margin:0,padding:0,border:"none",textAlign:"left",cursor:"pointer"},value:(0,c.Z)({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},t.Select),nativeSelect:{width:1,height:1,border:"none",outline:"none"},values:(0,j.Z)((0,c.Z)({position:"absolute",left:0,top:0,margin:0,padding:0,listStyle:"none",width:"100%",zIndex:10,overflow:"hidden","&:not([aria-expanded])":{display:"none"}},t.Select_Dropdown),{"& > li > button":(0,c.Z)({width:"100%",border:"none",background:"none",font:"inherit",textAlign:"inherit",cursor:"pointer"},t.Select_Dropdown_Value)})}}));(0,v.Z)({"@keyframes closing":{from:{gridTemplateRows:"1fr"},to:{gridTemplateRows:"0fr"}},"@keyframes opening":{from:{gridTemplateRows:"0fr"},to:{gridTemplateRows:"1fr"}},body:{display:"grid","& > div":{overflow:"hidden"}},isOpening:{animation:"0.2s ease $opening",animationFillMode:"forwards"},isClosing:{animation:"0.2s ease $closing",animationFillMode:"forwards"}},"lib::Spoiler");function re(e){var t=e.className,i=e.onStartClick,r=(0,d.Z)(y(),2),o=r[0],l=r[1],s={positive:oe(l.atoms.colors.positive),negative:oe(l.atoms.colors.negative),background:oe(l.atoms.colors.background)},c=function(e,t,i){Number.isNaN(i)&&(i=0),console.log(l.state,i,le(l.state["".concat(e,"Color")],t,i)),l.setState("".concat(e,"Color"),le(l.state["".concat(e,"Color")],t,i))},u=function(e){return function(t){e(t.target.valueAsNumber)}};return(0,n.jsxs)("section",{className:a(o.gameStartScreen,t),children:[(0,n.jsx)("div",{className:o.colorsSetters,children:Object.keys(s).map((function(e){return(0,n.jsxs)("div",{className:o.colorSetter,children:[(0,n.jsx)("input",{type:"number",min:0,max:255,value:s[e].r,onChange:u((function(t){return c(e,"r",t)}))}),(0,n.jsx)("input",{type:"number",min:0,max:255,value:s[e].g,onChange:u((function(t){return c(e,"g",t)}))}),(0,n.jsx)("input",{type:"number",min:0,max:255,value:s[e].b,onChange:u((function(t){return c(e,"b",t)}))}),(0,n.jsx)("div",{className:a(o.frame,o.colorBox),style:{backgroundColor:l.state["".concat(e,"Color")]}})]},e)}))}),(0,n.jsx)(J,{variant:"clean",body:"Start",onClick:i})]})}function oe(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}}function le(e,t,i){var n=i.toString(16).padStart(2,"0"),r="r"===t?1:"g"===t?3:5;return e.slice(0,r)+n+e.slice(r+2)}function se(e){var t=e.className,i=(0,o.useState)(!1),r=i[0],l=i[1];return(0,n.jsx)("div",{className:a(t),children:r?(0,n.jsx)(G,{}):(0,n.jsx)(re,{onStartClick:function(){return l(!0)}})})}function ae(){return de(),(0,n.jsx)(se,{})}var de=(0,r.Rk)((function(e){var t=e.atoms;return{"@global":{"*":{boxSizing:"border-box"},body:{margin:0,backgroundColor:t.colors.background,fontFamily:"consolas",fontSize:t.sizes.font.p},h3:{fontSize:t.sizes.font.h3}}}}))}},function(e){e.O(0,[826,774,888,179],(function(){return t=8312,e(e.s=t);var t}));var t=e.O();_N_E=t}]);